
ä¸ºäº†çµæ´»åº¦å’Œæ–¹ä¾¿ï¼Œä¸€èˆ¬é¡¹ç›®ç»“åˆ`è‡ªåŠ¨åŸ‹ç‚¹`å’Œ`æ‰‹åŠ¨åŸ‹ç‚¹`

## æ‰‹åŠ¨åŸ‹ç‚¹

æ‰‹åŠ¨åŸ‹ç‚¹çš„é‡ç‚¹åº”è¯¥åœ¨äºŽ å£°æ˜Žå¼ apiå½¢å¼è°ƒç”¨, å¤„ç†å¥½å‚æ•°å¤„ç†å’Œä¸Šé€å³å¯

è€Œåœ¨ Vue é‡Œåˆ™å¯ä»¥è€ƒè™‘è‡ªå®šä¹‰æŒ‡ä»¤æ¥å°è£…

```js
/**
 * å‘é€è¯·æ±‚ï¼Œä½¿ç”¨imageæ ‡ç­¾è·¨åŸŸ
 * @param url æŽ¥å£åœ°å€
 */
function sendRequest(url) {
    if (page.length === 0) {
        console.error('è¯·é…ç½®æœ‰æ•ˆçš„pageå‚æ•°', '@burying-point');
        return;
    }
    var img = new Image();
    img.src = url;
}
```        


## è‡ªåŠ¨åŸ‹ç‚¹

ðŸ¤” åœ¨ vue3 é‡Œç”¨ use çš„å½¢å¼åŸºäºŽæ‰‹åŠ¨åŸ‹ç‚¹å°è£…é€šç”¨çº§åˆ«çš„åŸ‹ç‚¹ä¹Ÿå¾ˆå®¹æ˜“ = = é‚£è¿˜éœ€è¦è‡ªåŠ¨åŸ‹ç‚¹å…¨æ”¶é›†å—

- é¡µé¢åˆ‡æ¢æ—¶ï¼Œè¿›è¡Œé‡‡é›†ï¼Œå³ url å˜åŒ–æ—¶è§¦å‘çš„äº‹ä»¶ï¼›
- é¡µé¢å¤±åŽ»ç„¦ç‚¹ï¼Œå¾—åˆ°ç„¦ç‚¹æ—¶ï¼Œè¿›è¡Œé‡‡é›†ã€‚å³ focusï¼Œblur äº‹ä»¶ï¼›
- é¡µé¢é€šè¿‡æµè§ˆå™¨ tab åˆ‡æ¢ç¦»å¼€ï¼Œåˆ‡æ¢å›žæ¥æ—¶ï¼Œè¿›è¡Œé‡‡é›†ï¼Œå³ visibilitychange äº‹ä»¶ï¼›

å› ä¸ºå•é¡µå¤šé¡µçš„é¡µé¢ç”Ÿå‘½å‘¨æœŸä¸åŒï¼Œå®žçŽ°è®¿é—®é‡çš„è‡ªåŠ¨åŸ‹ç‚¹çš„è®¾è®¡æ–¹å‘å°±æ˜¯ `url` çš„å˜åŒ–(å•é¡µå¤šé¡µéƒ½ä¼šå˜åŒ–)

1. urlå˜åŒ– = `window.location.origin + window.location.pathname + window.location.hash` è¿™ä¸‰éƒ¨åˆ†çš„ä»»ä¸€éƒ¨åˆ†å˜åŒ–ï¼Œå³ä¸º url å˜åŒ–ï¼Œå¹¶ä¸åŒ…æ‹¬ `window.location.search` è¿™éƒ¨åˆ†çš„å˜åŒ–ï¼›
2. åœ¨ SPA ä¸­ï¼Œå¦‚æžœä¸€ä¸ªé¡µé¢å†…æœ‰å¤šä¸ª tab(åµŒå¥—å­è·¯ç”±)ï¼Œå½“åˆ‡æ¢ tab æ—¶ï¼Œå¼€å‘è€…ä¹Ÿæ”¹å˜ä»–çš„ url çš„ `window.location.pathname`ï¼Œæ­¤æ—¶ä¹Ÿä¼šè®¤ä¸ºæ˜¯é¡µé¢åˆ‡æ¢ï¼Œä¹Ÿä¼šäº§ç”Ÿä¸ŠæŠ¥æ•°æ®(å¸Œæœ›çš„æ•ˆæžœæ˜¯åˆ‡æ¢é¡µé¢å†…çš„Tabä¸å±žäºŽè®¿é—®é‡çš„åŸ‹ç‚¹)

ðŸ‘‡ `history api` å¦‚ `pushstate,replacestate` è‡ªå®šä¹‰äº‹ä»¶ï¼Œå› ä¸º BOM å¹¶æ²¡æœ‰æä¾›ç›¸å…³çš„ api æ”¯æŒ EventListener(ä¼ é€’å›žè°ƒæ¥æ”¯æŒæ‹“å±•), éœ€è¦è‡ªè¡Œå°è£…ä½¿ç”¨
```js
/**
 * æ‹¼æŽ¥é€šç”¨åŒ–ä¸ŠæŠ¥å‚æ•°
 * @param {string} é‡å†™è·¯ç”±äº‹ä»¶ç±»åž‹
 */
function resetHistoryFun(type){
  // å°†åŽŸå…ˆçš„æ–¹æ³•å¤åˆ¶å‡ºæ¥
  let originMethod = window.history[type]
  // å½“window.history[type]å‡½æ•°è¢«æ‰§è¡Œæ—¶ï¼Œè¿™ä¸ªreturnå‡ºæ¥çš„å‡½æ•°å°±ä¼šè¢«æ‰§è¡Œ
  return function(){
    // æ‰§è¡ŒåŽŸå…ˆçš„æ–¹æ³•
    let rs = originMethod.apply(this, arguments)
    // ç„¶åŽè‡ªå®šä¹‰äº‹ä»¶
    let e = new Event(type.toLocaleLowerCase())
    // å°†åŽŸå…ˆå‡½æ•°çš„å‚æ•°ç»‘å®šåˆ°è‡ªå®šä¹‰çš„äº‹ä»¶ä¸ŠåŽ»ï¼ŒåŽŸå…ˆçš„æ˜¯æ²¡æœ‰çš„
    e.arguments = arguments
    // ç„¶åŽç”¨window.dispatchEvent()ä¸»åŠ¨è§¦å‘
    window.dispatchEvent(e)
    return rs;
  }
}
window.history.pushState = resetHistoryFun('pushState') // è¦†ç›–åŽŸæ¥çš„pushStateæ–¹æ³•
window.history.replaceState = resetHistoryFun('replaceState') // è¦†ç›–åŽŸæ¥çš„replaceStateæ–¹æ³•

window.addEventListener('pushstate', reportBothEvent)
window.addEventListener('replacestate', reportBothEvent)
```

ðŸ‘† å’Œå¾®å‰ç«¯é‡å†™routerçš„æ€è·¯ä¸€æ ·.... å¤šé¡µå‘¢ï¼Ÿurlä¸Šå‚æ•°éƒ¨åˆ†å‘¢? åµŒå¥—å­è·¯ç”±å‘¢?


```js
window.addEventListener('focus', ()=>{
  console.log('é¡µé¢å¾—åˆ°ç„¦ç‚¹')
});

window.addEventListener('blur', ()=>{
  console.log('é¡µé¢å¤±åŽ»ç„¦ç‚¹')
})
```

```js
document.addEventListener('visibilitychange',  () => {
  if(document.hidden) {
    console.log('é¡µé¢ç¦»å¼€')
  } else {
    console.log('é¡µé¢è¿›å…¥')
  }
})
```


æ•°æ®ä¸ŠæŠ¥æ–¹å¼æ˜¯ `XMLHttpRequest` `window.navigator.sendBeacon` åŸºäºŽ h5sdk ä¸ŠæŠ¥é€»è¾‘æž¶æž„ã€‚


# åŸ‹ç‚¹

ç›®å‰æŽ¥å…¥legoçš„åŸ‹ç‚¹æ–¹æ¡ˆ

TODO: 


å…³é”®ç‚¹ï¼š

å¦‚ä½•èŽ·å–å…ƒç´ çš„å”¯ä¸€æ ‡è®°ï¼Œå¹¶å¯é€šè¿‡è¯¥æ ‡è®°åå‘é€‰æ‹©å…ƒç´ 
å¦‚ä½•éšç€é¼ æ ‡çš„ç§»åŠ¨ï¼Œç»™å…ƒç´ æ·»åŠ æµ®å±‚
é¢‘ç¹çš„è·¨åŸŸ iframe é€šä¿¡ï¼Œè¯¥å¦‚ä½•ç®€åŒ–
å…ƒç´ çš„æ›å…‰å’Œç‚¹å‡»å¦‚ä½•åŒå…ƒç´ æ ‡è®°åŒ¹é…ä¸ŠæŠ¥


## XPath

```js

// å…¶ä¸­ findIndex ä»£ç å¦‚ä¸‹ï¼š
function findIndex(ele, currentTag) {
    let nth = 0;
    while (ele) {
        if (ele.nodeName.toLowerCase() === currentTag) nth += 1;
        ele = ele.previousElementSibling;
    }
    return nth;
}

function getXpath(ele) {
    let cur = ele;
    const path = [];
	while (cur.nodeType === Node.ELEMENT_NODE) {
		const currentTag = cur.nodeName.toLowerCase();
		const nth = findIndex(cur, currentTag);
		path.push(`${(cur.tagName).toLowerCase()}${(nth === 1 ? '' : `[${nth}]`)}`);
		cur = cur.parentNode;
	}
	return `/${path.reverse().join('/')}`;
}

```

## PC åŽå°åŸ‹ç‚¹

é‡‡é›†åˆ°è¿™ç§ xPath `/html/body/div[16]`

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/202307051529054.png)
ðŸ‘† å› ä¸ºå¼¹çª— divåœ¨æœ€å¤–å±‚ï¼Œé¡ºåºéšæœºï¼Œè¿™äº›è‡ªåŠ¨åŸ‹ç‚¹(åŸºäºŽä½ç½®)éƒ½æ˜¯æ— æ•ˆçš„

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/202307051533454.png)
ðŸ‘† åŒç† é¡¶éƒ¨Tab é¡µç­¾é¡ºåºéšæœºï¼Œå·¦ä¾§èœå•ä¸Žç”¨æˆ·æƒé™æœ‰å…³ï¼Œé¡ºåºéšæœº

æ­¤ç±»åŸ‹ç‚¹ï¼š
1. éœ€è¦æ‰‹åŠ¨é€šè¿‡æ ‡ç­¾å±žæ€§åŸ‹ç‚¹ï¼Œå¯ä»¥è€ƒè™‘å…¨å±€è‡ªå®šä¹‰antç»„ä»¶æ ‡ç­¾å±žæ€§
2. è‡ªåŠ¨åŸ‹ç‚¹å°è¯•ä¸ä¸Šé€ï¼Œå³æœ‰è‡ªå®šä¹‰æ‰‹åŠ¨åŸ‹ç‚¹å±žæ€§æ—¶ä¸ä¸Šé€ xpath

## å‰ç½®çŸ¥è¯†-æ— ç—•/å¯è§†åŒ–åŸ‹ç‚¹ï¼Œxpath

```js
function mouse_down(event) {
  var x = event.clientX,
    y = event.clientY;

  // æ ¹æ®åæ ‡èŽ·å–DOMå…ƒç´ 
  var element = document.elementFromPoint(x, y);
  if (!element) {
    console.log("error: no element");
  }
  // æ ¹æ®DOMå…ƒç´ èŽ·å–xpath
  readXPath(element)
}
```
xpath: `/html/body/div[2]/div[1]/div[1]/span[1]/input[1]/`

```js
function readXPath(element) {
  count = 1;
  result = "";

  while (true) {
    count += 1;
    if (count > 99) {
      break;
    }
    if (element == document.body) {
      console.log("/html/body/" + result);
      break;
    } else {
      tag_index = 0;
      tmp = element.parentElement;
      for (var i = 0; i < tmp.childElementCount; i++) {
        if (tmp.children[i].tagName == element.tagName) {
          tag_index += 1;
        }

        if (element == tmp.children[i]) {
          result =`${element.tagName.toLowerCase()}[${String(tag_index)}]/${result}`
          break;
        }
      }

      element = tmp;
    }
  }
}

document.onmousedown = mouse_down;
```

å¤±åŽ»åŸ‹ç‚¹æ•°æ®çš„å¯è¯»æ€§

ä»¥åŠå¸ƒå±€è°ƒæ•´åŽï¼ŒåŸ‹ç‚¹æ•°æ®é‡æ–°è®¡ç®—ï¼Œæ— æ³•æ•´åˆ

https://segmentfault.com/q/1010000043016040

https://developer.mozilla.org/zh-CN/docs/Web/XPath/Introduction_to_using_XPath_in_JavaScript

https://zhuanlan.zhihu.com/p/313016178

https://juejin.cn/post/7185362356652736570

https://juejin.cn/post/7156070053635424264

https://www.ucloud.cn/yun/82546.html

