
# ç±»å‹æ”¶çª„(æ¡ä»¶é€»è¾‘çš„ç±»å‹)

> ä¸è¦è¢«åè¯å“åˆ°...å°±ç®€å•çš„ç»éªŒæ¦‚å¿µ

æŒ‡ tsé™æ€åˆ†æ è‡ªåŠ¨æ¨å¯¼æœªæ¥è¿è¡Œæ—¶æ¡ä»¶è¯­å¥ä¸­çš„ç±»å‹

æœ¬å±äºåŸç†ç†è®ºï¼Œä½†å› ä¸ºå½±å“ä¸€äº›å¸¸ç”¨é€»è¾‘ç¼–å†™ç±»å‹ï¼Œå› æ­¤è¦ç†Ÿæ‚‰


## if è¯­å¥ typeof instanceof

ts å†…éƒ¨éœ€è¦è¯†åˆ« js æ¡ä»¶é€»è¾‘ä¸­çš„ `typeof/instanceof` , ts ç§°è¿™ç§è¯†åˆ«ä¸º `ç±»å‹ä¿æŠ¤ (type guard)`

```ts
function printAll(strs: string | string[] | null) {
  if (typeof strs === "object") {
    for (const s of strs) {
		  // strs is possibly 'null'.
      console.log(s);
    }
  } else if (typeof strs === "string") {
    console.log(strs);
  } else {
  }
}
```

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230321171455.png)

ts ä¿ç•™ js `typeof` è¯­æ³•çš„é—ç•™é—®é¢˜(`typeof null === 'object'`)

## if è¯­å¥ éšå¼ç±»å‹è½¬æ¢

js çš„ æ¡ä»¶è¯­å¥(`if`ã€`&&`ã€`||`ã€`switch`) å­˜åœ¨éšå¼ç±»å‹è½¬æ¢

å¦‚ `0 ã€NaNã€""ã€0nã€null undefined` è¿™äº›å€¼éƒ½ä¼šè¢«è½¬ä¸º `false`ï¼Œå…¶ä»–çš„å€¼åˆ™ä¼šè¢«è½¬ä¸º `true`

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230321172631.png)

ğŸ‘† åŒä¸€ä¸ªä¾‹å­ï¼Œjs çš„éšå¼ç±»å‹è½¬æ¢ï¼Œtsä¹Ÿå¯ä»¥è¯†åˆ«ï¼ŒæˆåŠŸæ”¶çª„ç±»å‹

## æ§åˆ¶æµåˆ†æï¼ˆControl flow analysisï¼‰

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230321175248.png)

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230321175311.png)

è‹¥ `padding` æ˜¯ `number` ç±»å‹ï¼Œæ— æ³•è¾¾åˆ° (`unreachable`) çš„éƒ¨åˆ†ï¼Œå°±ä¼šå°† numberç±»å‹ä» `number | string` ç±»å‹ä¸­åˆ é™¤æ‰

è¿™ç§åŸºäºå¯è¾¾æ€§(`reachability`) çš„ä»£ç åˆ†æå°±å«åšæ§åˆ¶æµåˆ†æ(`control flow analysis`)ã€‚

> ä¸Šé¢çš„éƒ½æ˜¯tså†…éƒ¨è‡ªåŠ¨æ¨å¯¼çš„ ç±»å‹æ”¶çª„
>
> ä¸‹é¢æ˜¯éœ€è¦æ‰‹åŠ¨å®ç°çš„ ç±»å‹æ”¶çª„

## is type æ‰‹åŠ¨ç±»å‹æ”¶çª„

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230321193840.png)


```ts
function isString(s: any) {
  return typeof s === 'string';
}

function toUpperCase(x: unknown) {
  if(isString(x)) {
    x.toUpperCase(); // âš¡ï¸ x is still of type unknown
  }
}
```

`if` æ¡ä»¶è¯­å¥é‡Œ `ts` ä¸èƒ½è‡ªåŠ¨æ‰§è¡Œå‡½æ•° (æœ‰äº† `ts` åä¸€èˆ¬ä¹Ÿå¾ˆå°‘è¦è¿è¡Œæ—¶åˆ¤æ–­ç±»å‹äº†å§)

ğŸ‘‡ ä½¿ç”¨ `is + type` å®šä¹‰å‡½æ•°çš„è¿”å›

```ts
function isString(s: any): s is string { // <-- âœ¨ å…¥å‚ is type
  return typeof s === 'string';
}
```


âœ¨ è¿‡æ»¤æ•°æ®æ—¶æœ‰ç”¨ï¼ï¼ï¼

`filter` ç­‰æ•°ç»„å·¥å…·å‡½æ•° `callback` æ˜¯è¿”å› `true/false` çš„å‡½æ•°, åœ¨å‡½æ•°å¼ç¼–ç¨‹é‡Œå¸¸æŠ½ç¦» åŸå­å‡½æ•°

æŠŠè¿™ä¸ªåŸå­å‡½æ•°å®šä¹‰æˆisï¼Œå¯ä»¥ç”¨äºæ›´å¤šåœ°æ–¹

```ts
interface Fish {}
interface Bird {}

function isFish(item: any): item is Fish {} // <-- âœ¨ åŸå­å‡½æ•°

const zoo: (Fish | Bird)[] = [fish1, fish2, bird1]
const afterList: Fish[] = zoo.filter(isFish)
```

## å¯è¾¨åˆ«è”åˆï¼ˆDiscriminated unionsï¼‰

ğŸ‘‡ æˆ‘ä»¬å¸¸é‡åˆ°è¿™æ ·çš„æ•°æ®ç»“æ„, ä¸åŒçš„ `itemType` èµ°ä¸åŒçš„é€»è¾‘

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230321200735.png)

è€Œ `aParams` å’Œ `bParams` éƒ½æ˜¯éå¿…å¡«çš„

ts å¹¶ä¸çŸ¥é“è¿™ç§æ•°æ®å†…éƒ¨é€»è¾‘

ğŸ‘‡ å¯ä»¥ç”¨éç©ºæ–­è¨€è§£å†³(ç”¨ `as` åŒç†)

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230321200815.png)


ğŸ‘‡ ä½†æ˜¯æˆ‘ä»¬å¸Œæœ›ç±»å‹å£°æ˜å¯ä»¥æ›´è¯­ä¹‰åŒ–ï¼Œä» ç±»å‹ ä¸Šçœ‹å‡ºæ•°æ®çš„å†…éƒ¨é€»è¾‘

```ts
interface A {
  itemType: 'a',
  aParams: number
}

interface B {
  itemType: 'b',
  bParams: number
}

type AorB = A | B // <-- âœ¨ å¯è¾¨åˆ«è”åˆï¼ˆDiscriminated unionsï¼‰

function run(params: AorB) {
  if(params.itemType === 'a') {
    return params.aParams * 2 // âœ…
  }else{
    return params.bParams * 2 // âœ…
  }
}
```

å¯è¾¨åˆ«è”åˆçš„åº”ç”¨è¿œä¸æ­¢è¿™äº›ï¼Œæ¯”å¦‚
- æ¶ˆæ¯æ¨¡å¼
- å®¢æˆ·ç«¯æœåŠ¡ç«¯çš„äº¤äº’
- çŠ¶æ€ç®¡ç†æ¡†æ¶

è¯•æƒ³åœ¨æ¶ˆæ¯æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬ä¼šç›‘å¬å’Œå‘é€ä¸åŒçš„äº‹ä»¶ï¼Œè¿™äº›éƒ½æ˜¯ä»¥åå­—è¿›è¡ŒåŒºåˆ†ï¼Œä¸åŒçš„äº‹ä»¶è¿˜ä¼šæºå¸¦ä¸åŒçš„æ•°æ®ï¼Œè¿™å°±åº”ç”¨åˆ°äº†å¯è¾¨åˆ«è”åˆ

```js
// æ¶ˆæ¯ å‘å¸ƒè®¢é˜…
const info = {
  typeName: 'doA',
  params: {}
}

// æ§åˆ¶ä¸­å¿ƒ
function handle(info) {
  if(info.typeName === 'doA') {
    doFnA(info.params) // <-- ğŸ’¥ ts å£°æ˜ä¸äº†é€»è¾‘ç›¸å…³æ•°æ®çš„ç±»å‹ åªèƒ½å®šä¹‰æˆ any
  }
  // ...
}
```

