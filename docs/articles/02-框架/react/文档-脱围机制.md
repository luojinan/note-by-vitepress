åœ¨ React å“²å­¦ä¸­ï¼Œé™¤äº†ä½¿ç”¨ react hook å†…éƒ¨å®šä¹‰çš„çŠ¶æ€ï¼Œå…¶ä»–å†…å®¹éƒ½è¢«å«åš `React ä¹‹å¤–çš„ç³»ç»Ÿ` å¦‚ï¼šæµè§ˆå™¨ API ç¼“å­˜ã€DOM æ“ä½œç­‰

è€Œåœ¨ React ä¸­äº React ä¹‹å¤–çš„ç³»ç»Ÿäº¤äº’ï¼Œå°±æ˜¯è„±å›´æœºåˆ¶

## useRef

æˆ‘ä»¬å¸¸ä½¿ç”¨ useRef æ¥è·å– React ç»„ä»¶å®ä¾‹ï¼Œå¦‚æœç»„ä»¶å†…éƒ¨ä½¿ç”¨äº† immutable æ¥æŠ›å‡ºæ•°æ®æˆ–è€…å‡½æ•°ï¼Œå°±å¯ä»¥é€šè¿‡ useRef.current æ¥è°ƒç”¨

ä½†æ˜¯é™¤äº†ç”¨äºè·å–ç»„ä»¶å®ä¾‹ï¼ŒuseRef è¿˜å¯ä»¥å’Œ useState ä¸€æ ·ç”¨äºå­˜å‚¨çŠ¶æ€

```tsx
import { useRef } from 'react';

export default function Counter() {
  let ref = useRef(0);

  function handleClick() {
    ref.current = ref.current + 1;
    alert('ä½ ç‚¹å‡»äº† ' + ref.current + ' æ¬¡ï¼');
  }

  return (
    <button onClick={handleClick}>
      ç‚¹æˆ‘ï¼
    </button>
  );
}
```

ä¸ state ä¸€æ ·ï¼Œref åœ¨é‡æ–°æ¸²æŸ“ä¹‹é—´ç”± React ä¿ç•™ã€‚ä½†æ˜¯ï¼Œè®¾ç½® state ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ï¼Œè€Œæ›´æ”¹ ref ä¸ä¼šï¼ä½ å¯ä»¥é€šè¿‡ ref.current å±æ€§è®¿é—®è¯¥ ref çš„å½“å‰å€¼ã€‚

> æ‰€ä»¥å¸Œæœ›ä½¿ç”¨ä¸€ä¸ªå˜é‡æ˜¯ä¸ä¼šè¢« react é‡ç½®çš„å€¼æ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ useState è¿˜æ˜¯ useRefï¼ŒuseState è‚¯å®šä¸ä¼šé”™ï¼Œå³ä½¿å½“å‰è¿™ä¸ªçŠ¶æ€ä¸ç”¨äºæ¸²æŸ“æ¸²æŸ“ç»„ä»¶ï¼Œä½†æ˜¯ä»¥åå¯èƒ½ä¼šç”¨
> å¦‚æœç”¨ useRefï¼Œåˆ™ä»¥åè¿­ä»£æ—¶éœ€è¦æ”¹ä¼šç”¨ useState

ref å°±åƒç»„ä»¶çš„ä¸€ä¸ªä¸è¢« React è¿½è¸ªçš„ç§˜å¯†å£è¢‹ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ ref æ¥å­˜å‚¨ timeout IDã€DOM å…ƒç´  å’Œå…¶ä»–ä¸å½±å“ç»„ä»¶æ¸²æŸ“è¾“å‡ºçš„å¯¹è±¡ã€‚

[useEffect](https://zh-hans.react.dev/learn/escape-hatches#synchronizing-with-effects)

ğŸ‘† è§£é‡Šäº†ä¸ºä»€ä¹ˆ useEffect ä¼šè¢«æ‰§è¡Œä¸¤æ¬¡ï¼Œå› ä¸ºè‰¯å¥½çš„ useEffect å¦‚æœä½¿ç”¨äº†ç±»ä¼¼å®šæ—¶å™¨çš„å…¨å±€å·¥å…·ï¼Œä¼šç¼–å†™å¥½ cleanup æ–¹æ³•ï¼Œå³å¯¹åº”åœ¨ useEffect å†… return ä¸€ä¸ªå‡½æ•°

å› æ­¤ react è®¤ä¸ºåœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œå¦‚æœæœ‰ cleanup çš„å­˜åœ¨ï¼Œå¤šæ‰§è¡Œä¸€æ¬¡ä¹Ÿä¸ä¼šå‡ºç°é€»è¾‘é—®é¢˜ï¼Œè€Œå¦‚æœå‡ºç°é€»è¾‘é—®é¢˜åˆ™è¯æ˜éœ€è¦è¡¥å…… cleanupï¼Œæ‰€ä»¥

React ç¬¬ä¸€æ¬¡æ‰§è¡Œ useEffectï¼Œä¼šæ‰§è¡Œå†…éƒ¨é€»è¾‘ï¼Œå¹¶æ‰§è¡Œ cleanup
React ç¬¬ä¸€æ¬¡æ‰§è¡Œ useEffectï¼Œåªä¼šæ‰§è¡Œå†…éƒ¨é€»è¾‘ï¼Œä¸æ‰§è¡Œ cleanup

ä»¥æ­¤æ¥è®© useEffect ä¸ç¼–å†™ cleanup å¯¼è‡´éšæ€§çš„é—®é¢˜å¯ä»¥æå‰æš´éœ²å‡ºæ¥

ğŸ¤” ä½†å…¶å®è¿™æ˜¯ä¸€ç§è¯­æ³•è§„èŒƒï¼Œä½¿ç”¨ Linter å°±å¯ä»¥æç¤ºäº†ï¼Œè€Œä¸éœ€è¦å†™åˆ°æ¡†æ¶çš„å†…éƒ¨å§ï¼Ÿæ˜¯å› ä¸ºå¸Œæœ›æ¯” Linter æ›´å¼ºçº¦æŸï¼Ÿ

```tsx
import { useState } from 'react';

export default function Counter() {
  const [count] = useState({value: 1});

  function handleClick() {
    console.log('count',JSON.stringify(count))
    count.value = count.value+1
    console.log('new count',JSON.stringify(count))
  }

  return (
    <button onClick={handleClick}>
      ç‚¹å‡»
    </button>
  );
}
```

ğŸ‘† åªè¦ä¸ä½¿ç”¨ setFn ï¼Œå¼•ç”¨ç±»å‹çš„æ•°æ®æ˜¯å®æ—¶æ›´æ–°çš„ï¼Œå¯ä»¥ç›´æ¥ console å‡ºæœ€æ–°çš„å€¼ï¼Œå› ä¸ºæ²¡æœ‰è§¦å‘é‡æ–°æ¸²æŸ“æ‰€ä»¥ useRef çš„çŠ¶æ€å§‹ç»ˆåœ¨å½“å‰çš„å¿«ç…§é‡Œ

ğŸ‘‡ åŸºç¡€æ•°æ®ç±»å‹åŒç†ï¼Œå› ä¸ºæ²¡æœ‰è§¦å‘é‡æ–°æ¸²æŸ“ï¼Œæ‰€æœ‰çŠ¶æ€éƒ½ä¼šæ˜¯å½“å‰å¿«ç…§

```tsx
import { useState } from 'react';

export default function Counter() {
  let [count] = useState(1); // âœ¨ éœ€è¦è®¾ç½®ä¸º let

  function handleClick() {
    console.log('count',count)
    count = count+1
    console.log('new count',count)
  }

  return (
    <button onClick={handleClick}>
      ä½ ç‚¹å‡»äº†
    </button>
  );
}
```

ğŸ‘† ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™æ ·ä¿®æ”¹çŠ¶æ€ï¼Œè€Œä¸ç»è¿‡ setFn å°†ä¼šå¯¼è‡´ react ä¸çŸ¥é“å½“å‰çš„çŠ¶æ€æ˜¯å¦‚ä½•å˜åŒ–è€Œæ¥ï¼Œå› æ­¤æœ€ç»ˆçš„æ¸²æŸ“å¯èƒ½ä¸å¯é¢„æµ‹

åªè¦ä½ æ”¹å˜çš„å¯¹è±¡ä¸ç”¨äºæ¸²æŸ“ï¼ŒReact å°±ä¸ä¼šå…³å¿ƒä½ å¯¹ ref æˆ–å…¶å†…å®¹åšäº†ä»€ä¹ˆã€‚
