# React åŸºç¡€

[Bç«™è§†é¢‘](https://www.bilibili.com/video/BV1Z44y1K7Fj)

[è§†é¢‘ç¬”è®°](https://www.yuque.com/fechaichai/qeamqf/xbai87)

å£°æ˜å¼UIã€å‘½ä»¤å¼UI

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230510004101.png)

ğŸ¤” å£°æ˜å¼è·¯ç”±ã€ç¼–ç¨‹å¼è·¯ç”±ï¼Œç¼–ç¨‹å¼å°±æ˜¯å‘½ä»¤å¼ï¼Ÿ

- ç»„ä»¶åŒ–(æ˜¯ä¸ªå‰ç«¯æ¡†æ¶éƒ½ä¼šè¿½æ±‚ç»„ä»¶åŒ–)
- jsx(åˆ©ç”¨ babel è½¬è¯‘ä¸ºæ­£å¸¸çš„ å‘½ä»¤å¼domæ“ä½œè¯­å¥)
- è·¨å¹³å°(è™šæ‹ŸDOM)


![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230510003854.png)


```jsx
import React from 'react'
import ReactDOM from 'react-dom'

// å¼•å…¥æ ¹ç»„ä»¶App
import App from './App'

// é€šè¿‡è°ƒç”¨ReactDOMçš„renderæ–¹æ³•æ¸²æŸ“Appæ ¹ç»„ä»¶åˆ°idä¸ºrootçš„domèŠ‚ç‚¹ä¸Š
ReactDOM.render(<App />, document.getElementById('root'))
```

ğŸ‘† å¼•å…¥çš„ `React` å¹¶æ²¡ç”¨å®é™…è°ƒç”¨çš„åœ°æ–¹(ç”¨äºå‘Šè¯‰è½¬è¯‘å™¨(`babel`)å½“å‰æ–‡ä»¶ä¼šæœ‰ `jsxè¯­æ³•` éœ€è¦è½¬è¯‘ï¼Ÿ)

`craè„šæ‰‹æ¶` é»˜è®¤é…ç½®ä½¿ç”¨ `babel` æ’ä»¶è½¬è¯‘è¯­æ³• `@babel/plugin-transform-react-jsx`

## JSX è¯­æ³•

1. å¿…é¡»æœ‰æ ¹èŠ‚ç‚¹ï¼Œå¯ä»¥ç”¨`<></>`å¹½çµèŠ‚ç‚¹è§£å†³
2. JSXè¯­æ³•å¯ä»¥ä¸ç”¨`()`åŒ…è£¹å¦‚ğŸ‘†çš„`ReactDOM.render(<App />,xx)`ï¼ŒJSXéœ€è¦æ¢è¡Œç¼–å†™æ—¶æ‰ç”¨`()`åŒ…è£¹
3. æ³¨é‡Š
```jsx
export default function App() {
  return (
    <div>
      {/* æ¡ä»¶æ¸²æŸ“å­—ç¬¦ä¸² */}
    </div>
  )
}
```
4. æ ·å¼ style
```jsx
export default function App() {
  return <div style={{ color: 'red' }}></div>
}
```
```jsx
const a = { color: 'red' }
export default function App() {
  return <div style={a}></div>
}
```
5. åŸ HTML æ ‡ç­¾å±æ€§ å¦‚classã€for ä¸ jsè¯­æ³•å†²çªçš„éœ€è¦å†™å‡ºå…¶ä»–å¦‚ `className` `htmlFor`

```jsx
export default function App() {
  return <div className="title"></div>
}
```

ğŸ‘‡ æˆ‘ä»¬æœ€ç®€åŒ–çš„å‡½æ•°ç»„ä»¶ç”šè‡³å¯ä»¥å†™ä¸º
```jsx
export default const App = () => <div>Hello App</div>
```

## å‡½æ•°ç»„ä»¶

JSXè¯­æ³•è½¬è¯‘å™¨ ä¼šæ ¹æ®æ ‡ç­¾é¦–å­—æ¯æ˜¯å¦å¤§å†™æ¥åˆ¤æ–­æ˜¯ç»„ä»¶è¿˜æ˜¯åŸHTMLæ ‡ç­¾

ğŸ‘† çš„æ‰€æœ‰ç¤ºä¾‹ä»£ç éƒ½æ˜¯å‡½æ•°ç»„ä»¶

å¦‚ï¼š`<App />` è½¬è¯‘å™¨åˆ¤æ–­åˆ°æ˜¯å¤§å†™æ ‡ç­¾å»æ‰§è¡Œç›¸åº”çš„å‡½æ•° `function App()`

è·å–å…·ä½“çš„UI(å› æ­¤å‡½æ•°ç»„ä»¶å¿…é¡»æœ‰`return`) ç›´åˆ°å…¨æ˜¯åŸHTMLæ ‡ç­¾æ²¡æœ‰ç»„ä»¶æ ‡ç­¾

åœ¨æ²¡æœ‰ Hooks ä¹‹å‰ï¼Œå‡½æ•°ç»„ä»¶ è¢«ç§°ä¸º æ— çŠ¶æ€ç»„ä»¶

## ç±»ç»„ä»¶

```jsx
class App extends React.Component {
  render () {
    return <div></div>
  }
}
```
ğŸ‘‡ å’Œå‡½æ•°ç»„ä»¶å¯¹æ¯”
```jsx
function App() {
  return <div></div>
}
```

ç®€å•ä½¿ç”¨çš„è¯ï¼Œä»…ä»…æ˜¯
- classè¯­æ³•(`extends`ã€`render(){}`)
- functionè¯­æ³•(`return`)

çš„åŒºåˆ«ï¼ŒJSXè¯­æ³•æ²¡æœ‰åŒºåˆ«

åŒç†è½¬è¯‘å™¨ åˆ¤æ–­åˆ° æ˜¯å¤§å†™æ ‡ç­¾å»æ‰§è¡Œç›¸åº”çš„classç±»ï¼Œæœ€ç»ˆç”±åŸºç±»è°ƒç”¨`render()` è·å–å…·ä½“çš„UI 

## äº‹ä»¶ç»‘å®š
### å‡½æ•°ç»„ä»¶äº‹ä»¶ç»‘å®š
```jsx
function App () {
  // å®šä¹‰äº‹ä»¶å›è°ƒå‡½æ•°
  const clickHandler = (e) => console.log('äº‹ä»¶è¢«è§¦å‘äº†', e)
  return (
    <>
      {/* ä¼ å…¥æœªæ‰§è¡Œçš„å‡½æ•° å¦‚éœ€è‡ªå®šä¹‰å‚æ•°åˆ™ç”¨ç®­å¤´å‡½æ•°åŒ…è£¹ */}
      <button onClick={clickHandler}>click me!</button>
      <button onClick={ () => clickHandler('1') }>click me!</button>
    </>
  )
}
```
ğŸ‘† ä¼ å…¥æœªæ‰§è¡Œçš„å‡½æ•° å¦‚éœ€è‡ªå®šä¹‰å‚æ•°åˆ™ç”¨ç®­å¤´å‡½æ•°åŒ…è£¹

### ç±»ç»„ä»¶äº‹ä»¶ç»‘å®š

å­˜åœ¨ this æŒ‡å‘é—®é¢˜

```jsx
class App extends React.Component {
  // class Fields
  clickHandler = (e) => {
    // è¿™é‡Œçš„thisæŒ‡å‘æ˜¯å½“å‰çš„ç»„ä»¶å®ä¾‹å¯¹è±¡ 
    // å¯ä»¥éå¸¸æ–¹ä¾¿çš„é€šè¿‡thiså…³é”®è¯æ‹¿åˆ°ç»„ä»¶å®ä¾‹èº«ä¸Šçš„å…¶ä»–å±æ€§æˆ–è€…æ–¹æ³•
    console.log(this)
  }

  // éç®­å¤´å‡½æ•°æ—¶ thisæŒ‡å‘è°ƒç”¨æ–¹(jsxæ ‡ç­¾è°ƒç”¨ä¼šæ˜¯undefined) 
  clickHandler1 () {
    // è¿™é‡Œçš„this ä¸æŒ‡å‘å½“å‰çš„ç»„ä»¶å®ä¾‹å¯¹è±¡è€ŒæŒ‡å‘undefined å­˜åœ¨thisä¸¢å¤±é—®é¢˜
    console.log(this)
  }

  render () {
    return (
      <div>
        <button onClick={this.clickHandler1}>âŒclick me</button>
        <button onClick={() => this.clickHandler1()}>âœ…click me</button>

        <button onClick={this.clickHandler}>âœ…click me</button>
        <button onClick={() => this.clickHandler('1')}>âœ…click me</button>
      </div>
    )
  }
}
```


## ç»„ä»¶çŠ¶æ€

ğŸ§ ï¼Ÿï¼Ÿï¼Ÿåœ¨React hookå‡ºæ¥ä¹‹å‰ï¼Œå‡½æ•°å¼ç»„ä»¶æ˜¯æ²¡æœ‰è‡ªå·±çš„çŠ¶æ€çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç»Ÿä¸€é€šè¿‡ç±»ç»„ä»¶æ¥è®²è§£

ç”¨ vue ä¸¾ğŸŒ° vue2ç»„ä»¶æ²¡æœ‰dataã€vue3ç»„ä»¶æ²¡æœ‰useRef useReactive, åªæœ‰ propsã€æ’æ§½ä¼ é€’çš„å°±æ˜¯æ— çŠ¶æ€é™æ€ç»„ä»¶(æ²¡æœ‰ç»„ä»¶å†…éƒ¨å¯ä»¥è‡ªå·±æ§åˆ¶çš„å˜é‡)

ç±»ç»„ä»¶çŠ¶æ€
```jsx
class App extends React.Component {
  state = {
    count: 1,
  }

  add = () => {
    this.setState({ count: this.state.count + 1 })
  }

  render () {
    return <div onClick={ this.add }>{this.state.count}</div>
  }
}
```
classå†…æ–¹æ³•ä¸ä½¿ç”¨ç®­å¤´å‡½æ•°æ—¶éœ€è¦æ‰‹åŠ¨(bind)å¤„ç†thisé—®é¢˜
```jsx
class App extends React.Component {
  constructor(props) {
    super(props)
    this.count = 1
  }

  add(){
    this.setState({ count: this.state.count + 1 })
  }

  render () {
    return <div onClick={ this.add.bind(this) }>{this.state.count}</div>
  }
}
```

```jsx
class App extends React.Component {
  constructor(props) {
    super(props)
    this.count = 1
    this.add = this.add.bind(this) // å®ä¾‹åŒ–æ—¶å…ˆå¤„ç†thisï¼Œåœ¨ä¸‹é¢è°ƒç”¨æ—¶å°±æ˜¯å¤„ç†åçš„æ–¹æ³•
  }

  add(){
    this.setState({ count: this.state.count + 1 })
  }

  render () {
    return <div onClick={ this.add }>{this.state.count}</div>
  }
}
```

å¯ä»¥çœ‹å‡º ç±»ç»„ä»¶ ä½¿ç”¨çŠ¶æ€2ç§æ–¹å¼`1.state 2.constructor` ä½¿ç”¨(`this.state.xx`)å’Œä¿®æ”¹(`this.setState`ç”±åŸºç±»æä¾›çœ‹ä¸åˆ°å£°æ˜è¯­å¥)éƒ½æ˜¯ç›¸åŒçš„

åŒºåˆ«åœ¨äº `state` æ˜¯ `constructor` çš„è¯­æ³•ç³–ï¼Œä¸éœ€è¦æ‰‹åŠ¨ç»§æ‰¿åŸºç±»ï¼Œç¼–å†™ `super(porps)`

setState ç”±åŸºç±»æä¾›ï¼Œè°ƒç”¨å°†è§¦å‘1. ä¿®æ”¹stateä¸­çš„å˜é‡å€¼ 2. è§¦å‘jsxçš„DOMæ›´æ–°æ¸²æŸ“

ğŸ¤” ç›´æ¥ä¿®æ”¹stateè€Œä¸ä½¿ç”¨setStateï¼šè™½ç„¶æ•°æ®ç¡®å®å˜åŒ–äº†ï¼Œä½†æ˜¯ä¸ä¼šè§¦å‘jsxçš„DOMé‡æ–°æ¸²æŸ“

ğŸ¤” React æŠŠç»„ä»¶çŠ¶æ€è®¾è®¡æˆä¸å¯å˜çš„ç›®çš„


ğŸ‘‡ ä½¿ç”¨ç®­å¤´å‡½æ•°çœç•¥æ‰‹åŠ¨è§£å†³thisé—®é¢˜
```jsx
class App extends React.Component {
  constructor(props) {
    super(props)
    this.count = 1
  }

  add = () => {
    this.setState({ count: this.state.count + 1 })
  }

  render () {
    return <div onClick={ this.add }>{this.state.count}</div>
  }
}
```

ğŸ¤” è¿™ä¸æ˜¯å•çº¯çš„ç®­å¤´å‡½æ•° è€Œæ˜¯ [class fieldsè¯­æ³•-MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Public_class_fields)

ğŸ‘‡ å¸¸è§„çš„classè¯­æ³•
```js
class Aclass{
  constructor() {}
  fn1() {}
}
```
`const fn1 = ()=>{}` è€Œ class fields ä¸ç”¨å£°æ˜ `fn1 = ()=>{}`

## é‡å­¦ class è¯­æ³•

[æ¢å¯»public class fields](https://juejin.cn/post/6944506173882105863)

å…¬æœ‰é™æ€å­—æ®µ(å¤šä¸ªç±»å…±ç”¨)ï¼šåœ¨æ¯ä¸ªç±»é‡Œåªå­˜åœ¨ä¸€ä»½ï¼Œè€Œä¸ä¼šå­˜åœ¨äºä½ åˆ›å»ºçš„æ¯ä¸ªç±»çš„å®ä¾‹ä¸­çš„å±æ€§ï¼Œå­˜æ”¾ç¼“å­˜æ•°æ®ã€å›ºå®šç»“æ„æ•°æ®æˆ–è€…å…¶ä»–ä½ ä¸æƒ³åœ¨æ‰€æœ‰å®ä¾‹éƒ½å¤åˆ¶ä¸€ä»½çš„æ•°æ®
å…¬æœ‰å®ä¾‹å­—æ®µ
```js
class Aclass {
  instanceField = 'å…¬æœ‰å®ä¾‹å­—æ®µ'
  static staticField = 'å…¬æœ‰é™æ€å­—æ®µ'
}

// æœªå®ä¾‹åŒ–ç±»ç›´æ¥è·å–å…¬æœ‰é™æ€å­—æ®µ
console.log(Aclass.staticField) // --> â€˜å…¬æœ‰é™æ€å­—æ®µâ€™
```
å¤šæ¬¡å®ä¾‹åŒ– é™æ€å­—æ®µ ä¸ä¼šé‡å¤åˆ›å»ºè€Œæ˜¯å¤šä¸ªå®ä¾‹å…±äº«

åŸç†ï¼šåœ¨å£°æ˜ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œä½¿ç”¨ Object.defineProperty() æ–¹æ³•å°†å…¬æœ‰é™æ€å­—æ®µæ·»åŠ åˆ°ç±»çš„æ„é€ å‡½æ•°ä¸­ã€‚åœ¨ç±»è¢«å£°æ˜ä¹‹åï¼Œå¯ä»¥ä»ç±»çš„æ„é€ å‡½æ•°è®¿é—®å…¬æœ‰é™æ€å­—æ®µ


ğŸ¤”ï¼šçœ‹èµ·æ¥ å…¬æœ‰å®ä¾‹å­—æ®µå’Œå…¬æœ‰é™æ€å­—æ®µéƒ½å¯ä»¥å®ç°çœç•¥ super(props) è€Œ React ä¸ºä»€ä¹ˆé€‰æ‹©ç”¨å…¬æœ‰å®ä¾‹å­—æ®µï¼Ÿ

## å—(ReactState)æ§ç»„ä»¶

input çš„è¡Œä¸ºå¯ä»¥å¾ˆå¥½çš„è§£é‡Š React å—æ§ç»„ä»¶çš„æ¦‚å¿µ

éå—æ§ç»„ä»¶ï¼šinputçš„çŠ¶æ€ä¸å—reactç»„ä»¶stateä¸­çš„çŠ¶æ€æ§åˆ¶ï¼Œè·å–å’Œä¿®æ”¹åªå…è®¸é€šè¿‡åŸç”Ÿdomæ“ä½œè¾“å…¥æ¡†çš„å€¼


inputæ¡†çš„çŠ¶æ€è¢«Reactç»„ä»¶çŠ¶æ€æ§åˆ¶ï¼Œåˆ™ input å°±æ˜¯å—æ§ç»„ä»¶

Reactç»„ä»¶çŠ¶æ€åœ¨stateä¸­ï¼Œinputè¡¨å•çš„çŠ¶æ€åœ¨valueä¸­ï¼ŒReactå°†stateä¸è¡¨å•å…ƒç´ çš„å€¼ï¼ˆvalueï¼‰ç»‘å®šåˆ°ä¸€èµ·ï¼Œç”±stateçš„å€¼æ¥æ§åˆ¶è¡¨å•å…ƒç´ çš„å€¼ï¼Œä»è€Œä¿è¯å•ä¸€æ•°æ®æºç‰¹æ€§

## é€šä¿¡

```jsx
import React from 'react'

// å‡½æ•°å¼å­ç»„ä»¶
function FunctionSon(props) {
  return <div>{props.msg}</div>
}

// ç±»å­ç»„ä»¶
class ClassSon extends React.Component {
  render() {
    return <div>{this.props.msg}</div>
  }
}

// ç±»çˆ¶ç»„ä»¶
class App extends React.Component {
  state = {
    message: 'this is parent message'
  }
  render() {
    return (
      <div>
        <FunctionSon msg={this.state.message} />
        <ClassSon msg={this.state.message} />
      </div>
    )
  }
}

export default App
```
ç±»å­ç»„ä»¶ç›´æ¥é€šè¿‡åŸºç±»çš„ `this.props.xx(çœ‹ä¸åˆ°å£°æ˜)` è·å–

å‡½æ•°å­ç»„ä»¶é€šè¿‡å‡½æ•°å‚æ•°è·å– `FunctionSon(xxx)`

å¹¶ä¸” React çš„ props é€šä¿¡æ”¯æŒä¼ é€’ JSX(ç»„ä»¶æ ‡ç­¾) ä¹Ÿå°±ç±»ä¼¼ Vue çš„æ’æ§½

props ä¼ é€’çš„ JSXï¼Œä¼šåœ¨ç¼–è¯‘æ—¶è½¬åŒ–ä¸º ReactElement vNode(è™šæ‹ŸDOMå¯¹è±¡)

è€Œç»„ä»¶æ ‡ç­¾ä¸­çš„å†…å®¹(å‡½æ•°ç»„ä»¶)åˆ™ä¼šè‡ªåŠ¨ä½œä¸º props.children ç­‰åŒäºæ ‡ç­¾å±æ€§ä¼ é€’å†™æ³•
ä½¿ç”¨æ–¹éœ€è¦è‡ªå·±æ ¹æ®å†…å®¹ä½¿ç”¨ï¼Œä¸é™æ­»ä¸ºç»„ä»¶

è¿™é‡Œæˆ‘ä»¬å°±ä¼šå‘ç° å‡½æ•°å­ç»„ä»¶å¯ä»¥è½»æ¾çš„å®šä¹‰propsçš„é»˜è®¤å€¼(é€šè¿‡å‡½æ•°å‚æ•°å®šä¹‰)
ä¹Ÿå¯ä»¥ä½¿ç”¨ ç»„ä»¶ åŸå‹å®šä¹‰ defaultProps
```jsx
function App() {
  return <div></div>
}
App.defaultProps = {
  msg: 'default msg'
}
```

è€Œ ç±»ç»„ä»¶ å› ä¸ºæ²¡æœ‰å£°æ˜propsè€Œæ˜¯ç›´æ¥ä½¿ç”¨åŸºç±» `this.props.xx` å› æ­¤åªèƒ½é¢å¤–ç¼–å†™ `static defaultProps = {}`
```jsx
class List extends Component {
  static defaultProps = {
    pageSize: 10
  }
  render() {
    return <div>æ­¤å¤„å±•ç¤ºpropsçš„é»˜è®¤å€¼ï¼š{this.props.pageSize}</div>
  }
}
```

```jsx
class List extends Component {
  render() {
    return <div>æ­¤å¤„å±•ç¤ºpropsçš„é»˜è®¤å€¼ï¼š{this.props.pageSize}</div>
  }
}
List.defaultProps = {
  pageSize: 10
}
```

TODO: ğŸ¤” ä¸ºä»€ä¹ˆè¿™é‡Œ React å°±ç”¨ å…¬æœ‰é™æ€å­—æ®µäº† å…¶ä»–çš„ state å´æ˜¯ å…¬æœ‰å®ä¾‹å­—æ®µ

å­ä¼ çˆ¶ ä¹Ÿè·Ÿå˜é‡ä¸€æ ·ï¼Œçˆ¶æŠŠæ“ä½œçˆ¶ç»„ä»¶çš„å‡½æ•°é€šè¿‡ props ä¼ é€’ç»™å­ç»„ä»¶è°ƒç”¨ï¼Œå°±æ˜¯å­ä¼ çˆ¶(æœ¬è´¨è¿˜æ˜¯props)




è·¨çº§é€šä¿¡ Context

```jsx
import React, { createContext }  from 'react'

// 1. åˆ›å»ºContextå¯¹è±¡ 
const { Provider, Consumer } = createContext()

// 3. æ¶ˆè´¹æ•°æ®
function ComC() {
  return (
    <Consumer >
      {value => <div>{value}</div>}
    </Consumer>
  )
}

function ComA() {
  return (
    <ComC/>
  )
}

// 2. æä¾›æ•°æ®
class App extends React.Component {
  state = {
    message: 'this is message'
  }
  render() {
    return (
      <Provider value={this.state.message}>
        <div className="app">
          <ComA />
        </div>
      </Provider>
    )
  }
}

export default App
```

## propsæ ¡éªŒ

æœ‰ ts åæ²¡å¿…è¦

ç»„ä»¶åº“å¼€å‘è€…ï¼Œä¸èƒ½é™åˆ¶äº†ç”¨æˆ·ä½¿ç”¨tsï¼Œè€Œä»ç„¶è¦ç±»å‹æ£€éªŒæ—¶ä½¿ç”¨ï¼

[prop-types](https://react.dev/reference/react/Component#static-proptypes) åŸç†

```jsx
import PropTypes from 'prop-types'

const FunctionComp = props => {
  const msg = props.msg
  return <div>{msg}</div>
}

FunctionComp.propTypes = {
  msg: PropTypes.string // <-- âœ¨ set prop type check
}
```

check at runtime ç¼–è¯‘æ—¶ä¸æ£€æŸ¥(tså¯ä»¥)


TODO: åŸç†, ç»™ å‡½æ•°ç»„ä»¶çš„åŸå‹ä¸Šç›´æ¥æŒ‚è½½ propTypes å±æ€§ï¼Œå†…éƒ¨ä¸ºçŠ¶æ€çš„ç±»å‹é…ç½®ï¼Œå³å¯å¼€å¯ ç±»å‹æ ¡éªŒ å¦‚ä½•å®ç°ï¼Ÿ

Vue å°±æ˜¯æŠŠè¿™ä¸ªåŒ…çš„æŒ‡è´£å†…ç½®äº†ï¼Œå› æ­¤ Vue çš„propsé…ç½®é¡¹æ›´å¤š

## ç”Ÿå‘½å‘¨æœŸ

æ³¨æ„ï¼Œåªæœ‰ç±»ç»„ä»¶æ‰æœ‰ç”Ÿå‘½å‘¨æœŸï¼ˆç±»ç»„ä»¶ å®ä¾‹åŒ–  å‡½æ•°ç»„ä»¶ ä¸éœ€è¦å®ä¾‹åŒ–ï¼‰

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20230511103554.png)

## Hooks

æ²¡æœ‰ Hooks å‰å¤§å®¶ä½¿ç”¨ ç±»ç»„ä»¶ æ—¶ï¼Œä¹Ÿæ˜¯æœ‰ å‡½æ•°ç»„ä»¶çš„(å¹¶ä¸æ˜¯åé¢å’Œ Hooks ä¸€åŒå‡ºç°)ï¼Œè€Œé‚£æ—¶å€™çš„ å‡½æ•°ç»„ä»¶ ä¸èƒ½æ‹¥æœ‰çŠ¶æ€ï¼Œåªèƒ½åšç®€å•åŠŸèƒ½çš„UI(é™æ€å…ƒç´ å±•ç¤º)

ç»è¿‡å¤šå¹´çš„å®æˆ˜ï¼Œå‡½æ•°ç»„ä»¶æ˜¯ä¸€ä¸ªæ›´åŠ åŒ¹é…Reactçš„è®¾è®¡ç†å¿µ UI = f(data)ï¼Œä¹Ÿæ›´æœ‰åˆ©äºé€»è¾‘æ‹†åˆ†ä¸é‡ç”¨çš„ç»„ä»¶è¡¨è¾¾å½¢å¼

ä¸ºäº†èƒ½è®©å‡½æ•°ç»„ä»¶å¯ä»¥æ‹¥æœ‰è‡ªå·±çš„çŠ¶æ€ï¼Œä»react v16.8å¼€å§‹ï¼ŒHooksåº”è¿è€Œç”Ÿ

1. ç»„ä»¶çš„é€»è¾‘å¤ç”¨
åœ¨hookså‡ºç°ä¹‹å‰ï¼Œreactå…ˆåå°è¯•äº† mixinsæ··å…¥ï¼ŒHOCé«˜é˜¶ç»„ä»¶ï¼Œrender-propsç­‰æ¨¡å¼

ä½†æ˜¯éƒ½æœ‰å„è‡ªçš„é—®é¢˜ï¼Œæ¯”å¦‚mixinçš„æ•°æ®æ¥æºä¸æ¸…æ™°ï¼Œé«˜é˜¶ç»„ä»¶çš„åµŒå¥—é—®é¢˜ç­‰ç­‰ 

2. classç»„ä»¶è‡ªèº«çš„é—®é¢˜
classç»„ä»¶å°±åƒä¸€ä¸ªåšé‡çš„â€˜æˆ˜èˆ°â€™ ä¸€æ ·ï¼Œå¤§è€Œå…¨ï¼Œæä¾›äº†å¾ˆå¤šä¸œè¥¿ï¼Œæœ‰ä¸å¯å¿½è§†çš„å­¦ä¹ æˆæœ¬ï¼Œæ¯”å¦‚å„ç§ç”Ÿå‘½å‘¨æœŸï¼ŒthisæŒ‡å‘é—®é¢˜ç­‰ç­‰

è€Œæˆ‘ä»¬æ›´å¤šæ—¶å€™éœ€è¦çš„æ˜¯ä¸€ä¸ªè½»å¿«çµæ´»çš„'å¿«è‰‡' 

### useState
ğŸ¤” ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ Hooks çš„ å‡½æ•°ç»„ä»¶ ä¸èƒ½æ‹¥æœ‰çŠ¶æ€
```jsx
function App() {
  let count = 1
  const add = () => count++ // ä¸ä¼šè§¦å‘é‡æ–°æ¸²æŸ“

  return <div onClick={add}>{count}</div>
}
```

```jsx
import { useState } from 'react'

function App() {
  let count = 1
  const [proxyCount, setProxyCount] = useState(count)
  const add = () => setProxyCount(proxyCount+1)

  return <div onClick={add}>{proxyCount}</div>
}
```

ç»„ä»¶ç¬¬äºŒæ¬¡æ¸²æŸ“(`useState` è¿”å›çš„æ•°ç»„ç¬¬äºŒé¡¹ `setProxyCount()` æ‰§è¡Œè§¦å‘é‡æ–°æ¸²æŸ“)
1. ç‚¹å‡»æŒ‰é’®ï¼Œè°ƒç”¨ setCount(count + 1) ä¿®æ”¹çŠ¶æ€ï¼Œå› ä¸ºçŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œæ‰€ä»¥ï¼Œè¯¥ç»„ä»¶ä¼šé‡æ–°æ¸²æŸ“
2. ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œä¼šå†æ¬¡æ‰§è¡Œè¯¥ç»„ä»¶ä¸­çš„ä»£ç é€»è¾‘
3. å†æ¬¡è°ƒç”¨ useState(1)ï¼Œæ­¤æ—¶ React å†…éƒ¨ä¼šæ‹¿åˆ°æœ€æ–°çš„çŠ¶æ€å€¼è€Œéåˆå§‹å€¼ï¼Œæ¯”å¦‚ï¼Œè¯¥æ¡ˆä¾‹ä¸­æœ€æ–°çš„çŠ¶æ€å€¼ä¸º 2
4. å†æ¬¡æ¸²æŸ“ç»„ä»¶ï¼Œæ­¤æ—¶ï¼Œè·å–åˆ°çš„çŠ¶æ€ count å€¼ä¸ºï¼š2

ğŸ‘† ä¹Ÿå°±æ˜¯è§¦å‘é‡æ–°æ¸²æŸ“ä¼šè®© useState ä¹Ÿé‡æ–°æ‰§è¡Œï¼Œä½†æ˜¯ useStateçš„å‚æ•°(åˆå§‹å€¼)åªä¼šåœ¨ç»„ä»¶ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶ç”Ÿæ•ˆã€‚æœ¬æ¬¡çš„æ¸²æŸ“ï¼ŒuseState è·å–åˆ°éƒ½æ˜¯æœ€æ–°çš„çŠ¶æ€å€¼ï¼ŒReact ç»„ä»¶ä¼šè®°ä½æ¯æ¬¡æœ€æ–°çš„çŠ¶æ€å€¼

åŒ…æ‹¬å‡½æ•° å˜é‡ç­‰éƒ½ä¼šé‡æ–°åˆ›å»ºï¼Œæ¶ˆè€—å†…å­˜(é‡å¤æ“ä½œå¦‚ä¸€äº›æšä¸¾å¸¸é‡)

```jsx
let num = 1
function App(){
  num++
  if(num / 2 === 0){
     const [name, setName] = useState('cp') 
  }
  const [list,setList] = useState([])
}
// ä¿©ä¸ªhookçš„é¡ºåºä¸æ˜¯å›ºå®šçš„ï¼Œè¿™æ˜¯ä¸å¯ä»¥çš„ï¼ï¼ï¼
```

è¦åœ¨å‡½æ•°ç»„ä»¶çš„æœ€å¤–å±‚ä½¿ç”¨

ä¸èƒ½åµŒå¥—åœ¨if/for/å…¶å®ƒå‡½æ•°ä¸­ï¼ˆreactæŒ‰ç…§hooksçš„è°ƒç”¨é¡ºåºè¯†åˆ«æ¯ä¸€ä¸ªhook???ï¼‰ 
å¯ä»¥é€šè¿‡å¼€å‘è€…å·¥å…·æŸ¥çœ‹hooksçŠ¶æ€ 

### useEffect

å‰¯ä½œç”¨

å‰¯ä½œç”¨æ˜¯ç›¸å¯¹äºä¸»ä½œç”¨æ¥è¯´çš„ï¼Œä¸€ä¸ªå‡½æ•°é™¤äº†ä¸»ä½œç”¨ï¼Œå…¶ä»–çš„ä½œç”¨å°±æ˜¯å‰¯ä½œç”¨ã€‚å¯¹äº React ç»„ä»¶æ¥è¯´ï¼Œä¸»ä½œç”¨å°±æ˜¯æ ¹æ®æ•°æ®ï¼ˆstate/propsï¼‰æ¸²æŸ“ UIï¼Œé™¤æ­¤ä¹‹å¤–éƒ½æ˜¯å‰¯ä½œç”¨ï¼ˆæ¯”å¦‚ï¼Œæ‰‹åŠ¨ä¿®æ”¹ DOMï¼‰

æ›´å¥½ç†è§£çš„ç°è±¡æ˜¯ï¼Œæ¯æ¬¡ç»„ä»¶æ›´æ–°éƒ½ä¼šè§¦å‘ï¼Œç±»ä¼¼ç”Ÿå‘½å‘¨æœŸï¼Œå¦‚æœä¸ä½¿ç”¨è¿™ä¸ª Hooks ä¼šæ‰§è¡Œå¤šæ¬¡ï¼Œè€Œå‰¯ä½œç”¨æ“ä½œä¸€èˆ¬éƒ½å¸Œæœ›å¯ä»¥åŠ¨æ€(å¯ä»¥è‡ªå®šä¹‰æ•°ç»„å†…çš„å˜é‡å˜åŒ–æ‰æ‰§è¡Œ)è§¦å‘

åœ¨ dom æ¸²æŸ“åæ‰§è¡Œï¼Œå› æ­¤å¯ä»¥é€šè¿‡ useRef è·å–ç»„ä»¶æˆ–å…ƒç´  dom

å¦‚å‘é€è¯·æ±‚ä¸€èˆ¬åªåœ¨åˆ›å»ºæ—¶æ‰§è¡Œä¸€æ¬¡(è¦å†™ä¸Šç©ºæ•°ç»„) å¦‚æœä¸ä½¿ç”¨ Hooks ç›´æ¥å†™å¤–å±‚å°†ä¼šæ¯æ¬¡æ›´æ–°éƒ½è¯·æ±‚

ä½†æ˜¯ Hooks çš„å‡ºç°ï¼Œå°±æ˜¯å¸Œæœ›æ²¡ç”¨ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œè€Œæ˜¯åªå…³æ³¨ å‡½æ•° å’Œ å‰¯ä½œç”¨ï¼Œæ¥ç¼–å†™ä»£ç 

ä¹Ÿå¯ä»¥å¯¹æ¯” vue çš„ computed


å¸¸è§çš„å‰¯ä½œç”¨
1. æ•°æ®è¯·æ±‚ ajaxå‘é€
2. æ‰‹åŠ¨ä¿®æ”¹dom
3. localstorageæ“ä½œ

TODO: useEffect åŒ…è£¹ä¼šäº§ç”Ÿå‰¯ä½œç”¨çš„é€»è¾‘ï¼Œ å¯ä»¥æŠŠå‰¯ä½œç”¨å¤„ç†æ‰ï¼ŸåŸç†

```jsx
import { useEffect, useState } from 'react'

function App() {
  const [count, setCount] = useState(0)

  // ç«‹å³æ‰§è¡Œ é‡æ–°æ¸²æŸ“ä¹Ÿä¼šæ‰§è¡Œ
  useEffect(()=>{
    document.title = `å½“å‰å·²ç‚¹å‡»äº†${count}æ¬¡` // å‰¯ä½œç”¨ DOMæ“ä½œ
  })

  return (
    <button onClick={() => { setCount(count + 1) }}>{count}</button>
  )
}
```
ğŸ‘‡ useEffect ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ§åˆ¶åŒ¹é…å…·ä½“å¯¼è‡´é‡æ–°æ¸²æŸ“çš„å˜é‡æ‰æ‰§è¡Œï¼Œå¦‚æœæ˜¯ç©ºæ•°ç»„å°†åªåœ¨é¦–æ¬¡æ¸²æŸ“æ—¶æ‰§è¡Œä¸€æ¬¡
```jsx
useEffect(() => {    
  console.log('å‰¯ä½œç”¨æ‰§è¡Œäº†')  
}, [count])  
```

æ¸…é™¤å‰¯ä½œç”¨

å› ä¸º å‡½æ•°ç»„ä»¶ æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸçš„æ¦‚å¿µï¼Œ æ‰€ä»¥æ¸…é™¤å‰¯ä½œç”¨ä¸åº”è¯¥è€ƒè™‘é”€æ¯çš„æ¦‚å¿µ ğŸ‘‡

åœ¨å‰¯ä½œç”¨å‡½æ•°ä¸­çš„æœ«å°¾returnä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨æ–°çš„å‡½æ•°ä¸­ç¼–å†™æ¸…ç†å‰¯ä½œç”¨çš„é€»è¾‘
æ³¨æ„æ‰§è¡Œæ—¶æœºä¸ºï¼š
1. ç»„ä»¶å¸è½½æ—¶è‡ªåŠ¨æ‰§è¡Œ
2. ç»„ä»¶æ›´æ–°æ—¶ï¼Œä¸‹ä¸€ä¸ªuseEffectå‰¯ä½œç”¨å‡½æ•°æ‰§è¡Œä¹‹å‰è‡ªåŠ¨æ‰§è¡Œ
```jsx
import { useEffect, useState } from "react"
const App = () => {
  const [count, setCount] = useState(0)

  useEffect(() => {
    const timerId = setInterval(() => {
      setCount(count + 1)
    }, 1000)
    return () => { // ç”¨æ¥æ¸…ç†å‰¯ä½œç”¨çš„äº‹æƒ…
      clearInterval(timerId)
    }
  }, [count])

  return <div>{count}</div>
}
```

```jsx
// âŒ ä¸å¯ä»¥ç›´æ¥åœ¨useEffectçš„å›è°ƒå‡½æ•°å¤–å±‚ç›´æ¥åŒ…è£¹ await ï¼Œå› ä¸ºå¼‚æ­¥ä¼šå¯¼è‡´æ¸…ç†å‡½æ•°æ— æ³•ç«‹å³è¿”å›
useEffect(async ()=>{    
  const res = await axios.get('xxx')   
  console.log(res)
},[])
// âœ…
useEffect(()=>{    
  async function fetchData(){      
    const res = await axios.get('xxx')
    console.log(res)   
  }
  fetchData()
},[])
```

### useRef

è·å–åŸç”ŸDOM/ç±»ç»„ä»¶å®ä¾‹

æ‰§è¡Œ useRef å‡½æ•°å¹¶ä¼ å…¥nullï¼Œè¿”å›å€¼ä¸ºä¸€ä¸ªå¯¹è±¡ å†…éƒ¨æœ‰ä¸€ä¸ªcurrentå±æ€§å­˜æ”¾æ‹¿åˆ°çš„domå¯¹è±¡ï¼ˆç»„ä»¶å®ä¾‹ï¼‰
é€šè¿‡ref ç»‘å®š è¦è·å–çš„å…ƒç´ æˆ–è€…ç»„ä»¶

```jsx
function App() {
  const domRef = useRef(null)
  const classCompRef = useRef(null)
  return <div ref={ domRef }></div>
  // return <classComp ref={ classCompRef }></classComp>
}
```

å‡½æ•°ç»„ä»¶ç”±äºæ²¡æœ‰å®ä¾‹ï¼Œä¸èƒ½ä½¿ç”¨refè·å–ï¼Œå¦‚æœæƒ³è·å–ç»„ä»¶å®ä¾‹ï¼Œå¿…é¡»æ˜¯ç±»ç»„ä»¶

### useContext

ä¸Šé¢ï¼Œæˆ‘ä»¬ç”¨åˆ°äº† `const { Provider, Consumer } = createContext()`

`<Provider>`å’Œ`<Consumer>` ç»„ä»¶æ ‡ç­¾ï¼Œæ¥åŒ…è£¹éœ€è¦è·¨å±‚çº§é€šä¿¡çš„ç»„ä»¶ï¼Œåœ¨åŒ…è£¹åçš„ä½œç”¨åŸŸå†…å¯ä»¥å…±äº«æŒ‡å®šçš„æ•°æ®

ä½¿ç”¨ useContext Hooks å¯ä»¥çœç•¥åŒ…è£¹`<Consumer>` çš„æ­¥éª¤

```jsx
import { createContext, useContext } from 'react'
// 1. åˆ›å»ºContextå¯¹è±¡
const {Provider} = createContext()

function Foo() {  
  return <div>Foo <Bar/></div>
}

function Bar() {  
  // 3. åº•å±‚ç»„ä»¶é€šè¿‡useContextå‡½æ•°è·å–æ•°æ® âœ¨ è€Œä¸æ˜¯åŒ…è£¹<Consumer>
  const name = useContext(Context)
  return <div>Bar {name}</div>
}

function App() {  
  return (    
    // 2. é¡¶å±‚ç»„ä»¶é€šè¿‡Provider æä¾›æ•°æ®    
    <Provider value={'this is name'}>     
      <div><Foo/></div>    
    </Provider>  
  )
}

export default App
```

### è‡ªå®šä¹‰Hooks

ç®€å•çš„è¿”å›ç‰¹å®šç»“æ„çš„å‡½æ•° ä¸ç®—æœ‰æ„ä¹‰çš„Hooksï¼Œè‡ªå®šä¹‰çš„ Hooks éœ€è¦é…åˆ React å†…ç½®Hooksä½¿ç”¨ æ‰æœ‰æ„ä¹‰

è·å–æ»šåŠ¨è·ç¦»Y `const [y] = useWindowScroll()`

```jsx
import { useState, useEffect } from "react"

export function useWindowScroll () {
  const [y, setY] = useState(0)
  useEffect(()=>{
     const scrollHandler = () => {
        const h = document.documentElement.scrollTop
        setY(h)
     })
     window.addEventListener('scroll', scrollHandler)
     return () => window.removeEventListener('scroll', scrollHandler)
  })
 
  return [y]
}
```

âŒ å‡å¦‚ä¸ä½¿ç”¨ useEffectï¼Œ å¯ä»¥åœ¨ç»„ä»¶é¦–æ¬¡æ¸²æŸ“æ—¶è·å–åˆ°yï¼Œä¹Ÿå¯ä»¥åœ¨é€‚ç”¨æ–¹ç»„ä»¶æ¯æ¬¡æ›´æ–°æ—¶è·å–åˆ°yï¼Œä½†æ˜¯æˆ‘ä»¬å¸Œæœ›è‡ªå·±å†³å®šyçš„æ›´æ–°ï¼Œå¦‚æ»šåŠ¨é¡µé¢æ—¶æ›´æ–°ï¼Œè€Œä¸æ˜¯ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶æ›´æ–°ï¼Œè¿™å°±æ˜¯ useEffect çš„ä½œç”¨ï¼Œè‡ªå®šä¹‰æ›´æ–°æ—¶é—´ï¼Œè‡ªå®šä¹‰è§¦å‘æ—¶é—´ï¼Œè„±ç¦»ä½¿ç”¨æ–¹ç»„ä»¶çš„æ§åˆ¶ï¼Œä¹Ÿæ˜¯å¾ˆå¤šå‰¯ä½œç”¨(å…¨å±€å˜é‡windowäº‹ä»¶çš„åœºæ™¯)

ä¸ä½¿ç”¨ useEffect ä¹Ÿå¯ä»¥


æ¯æ¬¡ä¿®æ”¹messageæ•°æ®çš„æ—¶å€™ éƒ½ä¼šè‡ªåŠ¨å¾€LocalStorageåŒæ­¥ä¸€ä»½ `const [message, setMessage] = useLocalStorage(keyï¼ŒdefaultValue)`
```jsx
import { useEffect, useState } from 'react'

export function useLocalStorage (key, defaultValue) {
  const [message, setMessage] = useState(defaultValue)
  // æ¯æ¬¡åªè¦messageå˜åŒ– å°±ä¼šè‡ªåŠ¨åŒæ­¥åˆ°æœ¬åœ°ls
  useEffect(() => {
    window.localStorage.setItem(key, message)
  }, [message, key])
  return [message, setMessage]
}
```

## Router

å†…ç®¡é¡µé¢ è·¯ç”±é…ç½®ä¸€èˆ¬ç»“æ„æ˜¯ layout-ä¸€çº§è·¯ç”± å†…å®¹äºŒçº§è·¯ç”±

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä»è·¯å¾„ä¸Šçœ‹ `localhost:3000/login` `localhost:3000/list`
è¿™2ä¸ªè·¯å¾„(è·¯ç”±)è¦æœ‰ä¸åŒçš„å¸ƒå±€listæ˜¯å†…ç®¡å¸ƒå±€ï¼Œloginä¸å¥—å¸ƒå±€

è¿™ç§æ—¶å€™å°±è¦æŠŠlayoutä½œä¸º / æ ¹è·¯ç”±ï¼Œä½†æ˜¯/loginä¹Ÿä¼šåŒ¹é…åˆ°æ ¹è·¯ç”±çš„å¸ƒå±€

æ‰€ä»¥åšæˆäºŒçº§è·¯ç”± åŒ¹é…åˆ°ä¸€çº§è·¯ç”± /login å°±ä¸ä¼šè¿›å…¥ /æ ¹è·¯å¾„çš„äºŒçº§è·¯ç”±

## mobox

æ¨¡å—åŒ– åˆ©ç”¨åˆ°äº†React `<context>`

è‡ªå·±çœ‹å®˜æ–¹æ–‡æ¡£å§
