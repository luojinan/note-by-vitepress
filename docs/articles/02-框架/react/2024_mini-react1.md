2024 [React18åº•å±‚æºç ](https://coding.imooc.com/class/818.html)

::: details ç›®å½•

```text
ç¬¬1ç«  è¯¾ç¨‹ä»‹ç»

ç¬¬2ç«  å­¦å‰æŠ€æœ¯å‚¨å¤‡ï¼šReactæ ¸å¿ƒçŸ¥è¯†ç‚¹è®²è§£
2-1 ä¸ºä»€ä¹ˆè¦å­¦ä¹ Reactæºç 
2-2 Reactçš„è¿­ä»£å†å²ï¼šé‚£äº›æ ‡å¿—æ€§çš„å˜é©ï¼Œå¦‚ç±»ç»„ä»¶ã€Fiberã€Hooksã€Concurrentç­‰
2-3 Thinking in Reactï¼Œå³ç”¨Reactçš„æ–¹å¼å†™React-1
2-4 Thinking in Reactï¼Œå³ç”¨Reactçš„æ–¹å¼å†™React-2
2-5 Reactä¸­çš„çŠ¶æ€ç®¡ç†ä¸çŠ¶æ€ç®¡ç†åº“-1
2-6 Reactä¸­çš„çŠ¶æ€ç®¡ç†ä¸çŠ¶æ€ç®¡ç†åº“-2
2-7 state (çŠ¶æ€)ä¸props (å±æ€§)
2-8 Reactä¸­çš„ç»„ä»¶ï¼Œå¦‚å‡½æ•°ç»„ä»¶ã€ç±»ç»„ä»¶ç­‰
2-9 Hooks
2-10 Context
2-11 Reactè„šæ‰‹æ¶ä»¥åŠä¼ä¸šçº§æ¡†æ¶
2-12 React ç»„ä»¶çš„å¸¸è§æ€§èƒ½ä¼˜åŒ–-1
2-13 React ç»„ä»¶çš„å¸¸è§æ€§èƒ½ä¼˜åŒ–-2
2-14 React ç»„ä»¶çš„å¸¸è§æ€§èƒ½ä¼˜åŒ–-3

ç¬¬3ç«  å­¦ä¹ å‰ï¼šåº•å±‚æºç çš„é«˜æ•ˆå­¦ä¹ æ–¹æ³•åˆ†äº«
3-1 -1 å¦‚ä½•é«˜æ•ˆå­¦ä¹ Reactæºç 
3-2 -2 å¦‚ä½•é«˜æ•ˆå­¦ä¹ Reactæºç 
3-3 å¦‚ä½•debug Reactæºç 
3-4 å¦‚ä½•è¿è¡ŒReactæµ‹è¯•ç”¨ä¾‹
3-5 å¦‚ä½•æˆä¸ºReact Contributor

ç¬¬4ç«  ä»£ç å®è·µï¼šæ‰“é€ è½®å­ï¼Œè‡ªå·±çš„mini reactæ¡†æ¶
4-1 é€ è½®å­çš„ä¼˜åŠ¿ä»¥åŠæ­¥éª¤
4-2 æ­å»ºè‡ªå·±çš„mini reacté¡¹ç›®

ç¬¬5ç«  React18å…¨æ–°åº•å±‚æ ¸å¿ƒè¿è¡Œæœºåˆ¶ï¼šä»»åŠ¡è°ƒåº¦æœºåˆ¶çš„ä»£ç å®è·µ
5-1 å®ç°ä»»åŠ¡è°ƒåº¦ç®—æ³•-1
5-2 å®ç°ä»»åŠ¡è°ƒåº¦ç®—æ³•-ä»€ä¹ˆæ˜¯æœ€å°å †-2
5-3 å®ç°ä»»åŠ¡è°ƒåº¦ç®—æ³•-å®ç°æœ€å°å †çš„peekä¸pushå‡½æ•°-3
5-4 å®ç°ä»»åŠ¡è°ƒåº¦ç®—æ³•-å®ç°æœ€å°å †çš„popå‡½æ•°-4
5-5 ä»»åŠ¡è°ƒåº¦å™¨scheduler
5-6 å¦‚ä½•å®ç°æ—¶é—´åˆ‡ç‰‡
5-7 å¦‚ä½•å®ç°ä»»åŠ¡è°ƒåº¦å‡½æ•°å…¥å£.mp4
5-8 å¦‚ä½•å®ç°ä¸€ä¸ªrequestIdleCallback.mp4
5-9 å¦‚ä½•è°ƒåº¦å»¶è¿Ÿä»»åŠ¡
5-10 æ€»ç»“ï¼šæºç å®è·µReactåº•å±‚ä»»åŠ¡è°ƒåº¦æœºåˆ¶

ç¬¬6ç«  React18å…¨æ–°åº•å±‚æ ¸å¿ƒè¿è¡Œæœºåˆ¶ï¼šä»»åŠ¡è°ƒåº¦æœºåˆ¶æºç é˜…è¯»ï¼Œæ€ç»´æ‹”é«˜
6-1 å‰–æReactä¸­çš„ä»»åŠ¡è°ƒåº¦å™¨åœºæ™¯ï¼šåˆä½œå¼è°ƒåº¦å™¨ & æŠ¢å å¼è°ƒåº¦å™¨
6-2 å‰–æReactä»»åŠ¡è°ƒåº¦æºç 

ç¬¬7ç«  Reactæ¸²æŸ“æœºåˆ¶ï¼šåŸå§‹æ¸²æŸ“VDOMä¸æ€§èƒ½æ”¹é©Fiberçš„æºç å‰–æ
7-1 VDOMçš„å››å¤§é—®é¢˜ï¼šwhatã€whyã€whereã€how
7-2 -1 Fiberè¯¦è§£
7-3 -2 Fiberè¯¦è§£
7-4 æŒæ¡ä¸åŒç±»å‹ç»„ä»¶çš„Fiberï¼šæŸ¥çœ‹å¹¶è°ƒè¯•

ç¬¬8ç«  Reactæ¸²æŸ“æœºåˆ¶ï¼šReactä¸­åˆæ¬¡æ¸²æŸ“æµç¨‹æ·±åº¦å‰–æ
8-1 åœ¨æµè§ˆå™¨DOM èŠ‚ç‚¹ä¸­åˆ›å»ºæ ¹èŠ‚ç‚¹ï¼šcreateRoot -1
8-2 -2 åœ¨æµè§ˆå™¨DOM èŠ‚ç‚¹ä¸­åˆ›å»ºæ ¹èŠ‚ç‚¹ï¼šcreateRoot
8-3 -3 åœ¨æµè§ˆå™¨DOM èŠ‚ç‚¹ä¸­åˆ›å»ºæ ¹èŠ‚ç‚¹ï¼šcreateRoot
8-4 -4 åœ¨æµè§ˆå™¨DOM èŠ‚ç‚¹ä¸­åˆ›å»ºæ ¹èŠ‚ç‚¹ï¼šcreateRoot
8-5 -1 root.renderä¸unmountå‡½æ•°çš„æµç¨‹
8-6 -1 root.renderä¸unmountå‡½æ•°çš„æµç¨‹
8-7 -1 updateçš„æ•°æ®ç»“æ„ä¸ç®—æ³•.mp4
8-8 -2updateçš„æ•°æ®ç»“æ„ä¸ç®—æ³•.mp4
8-9 -1 scheduleUpdateOnFiberè°ƒåº¦æ›´æ–°.mp4
8-10 -2 scheduleUpdateOnFiberè°ƒåº¦æ›´æ–°
8-11 -3 scheduleUpdateOnFiberè°ƒåº¦æ›´æ–°
8-12 renderé˜¶æ®µ
8-13 renderé˜¶æ®µ-beginWork
8-14 renderé˜¶æ®µ-renderRootConcurrent
8-15 commité˜¶æ®µ

ç¬¬9ç«  Reactæ¸²æŸ“æœºåˆ¶ï¼šé¡µé¢åˆæ¬¡æ¸²æŸ“åŸç”Ÿæ ‡ç­¾ä»£ç å®è·µ

ç¬¬10ç«  Reactæ¸²æŸ“æœºåˆ¶ï¼šæ‰‹å†™ä¸åŒç»„ä»¶çš„æ¸²æŸ“è¿‡ç¨‹ï¼ŒæŒæ¡å…¶æœºåˆ¶åŸç†
10-1 å¦‚ä½•å®ç°å¤šä¸ªåŸç”Ÿæ ‡ç­¾å­èŠ‚ç‚¹æ¸²æŸ“çš„æºç .mp4
10-2 å¦‚ä½•å®ç°æ–‡æœ¬èŠ‚ç‚¹æ¸²æŸ“çš„æºç .mp4
10-3 å¦‚ä½•å®ç°Fragmentæ¸²æŸ“çš„æºç .mp4
10-4 å¦‚ä½•å®ç°ç±»ç»„ä»¶æ¸²æŸ“çš„æºç .mp4
10-5 å®ç°å‡½æ•°ç»„ä»¶æ¸²æŸ“çš„æºç .mp4

ç¬¬11ç«  Reactå¼€å‘çš„åˆ©å™¨ï¼šHooksåº•å±‚åˆ†æ
11-1 Hookç®€ä»‹
11-2 Hookè§„åˆ™èƒŒåçš„åŸå› .mp4
11-3 å‡½æ•°ç»„ä»¶çš„Hookæºç è§£è¯».mp4
11-4 -1 useReduceræºç è§£è¯».mp4
11-5 -2 useReduceræºç è§£è¯»
11-6 useStateæºç è§£è¯»

ç¬¬12ç«  Reactå¼€å‘çš„åˆ©å™¨ï¼šæ‰‹å†™å®ç°Hooksï¼ŒæŒæ¡Hooksåº•å±‚æ•°æ®ç»“æ„
12-1 æ¨¡æ‹Ÿäº‹ä»¶ï¼Œåˆæ­¥å®ç°useReducer
12-2 å®ç°useReducerï¼ŒæŒæ¡Hooksçš„åº•å±‚ç»“æ„å®ç°ä¸å‡½æ•°ç»„ä»¶çš„çŠ¶æ€-1
12-3 å®ç°useReducerï¼ŒæŒæ¡Hooksçš„åº•å±‚ç»“æ„å®ç°ä¸å‡½æ•°ç»„ä»¶çš„çŠ¶æ€-2
12-4 èŠ‚ç‚¹åˆ é™¤.mp4
12-5 åˆæ­¥å®ç°å¤šä¸ªèŠ‚ç‚¹çš„React VDOM DIFF-1
12-6 åˆæ­¥å®ç°å¤šä¸ªèŠ‚ç‚¹çš„React VDOM DIFF-2
12-7 å®Œå–„å®ç°React VDOM DIFFç®—æ³•
12-8 å¦‚ä½•ç§»åŠ¨DOMèŠ‚ç‚¹
12-9 å®ç°useState.mp4
12-10 å­èŠ‚ç‚¹ä¸ºnullã€undefinedã€å¸ƒå°”å€¼

ç¬¬13ç«  Reactå¼€å‘çš„åˆ©å™¨ï¼šReact VDOM DIFFç®—æ³•æºç å‰–æ
13-1 åˆ†æä¸åŒå­èŠ‚ç‚¹ç±»å‹ï¼ŒReact VDOM DIFFçš„å¤„ç†
13-2 åè°ƒå•ä¸ªèŠ‚ç‚¹
13-3 åè°ƒå¤šä¸ªå­èŠ‚ç‚¹
13-4 åè°ƒæ–‡æœ¬èŠ‚ç‚¹
13-5 æ‹“å±•-ä¸Vue3 VDOM DIFFå¯¹æ¯”

ç¬¬14ç«  Reactå¼€å‘çš„åˆ©å™¨ï¼šHooksè¿›é˜¶ï¼Œä»£ç å®è·µæ‰‹åŠ¨å®ç°API
14-1 å¦‚ä½•å®ç°useMemo
14-2 å¦‚ä½•å®ç°useCallback
14-3 useMemoä¸useCallback
14-4 å¦‚ä½•å®ç°useRef
14-5 å¦‚ä½•å®ç°useLayoutEffect
14-6 å¦‚ä½•å®ç°useLayoutEffectçš„effectæ‰§è¡Œ
14-7 å¦‚ä½•å®ç°useEffectçš„effectæ‰§è¡Œ.mp4

ç¬¬15ç«  Reactä¸­çš„æ•°æ®æ¨¡å¼ï¼šä»£ç å®ç°ï¼ŒæŒæ¡Contextå®ç°åŸç†
15-1 çŸ¥è¯†åˆ†æï¼šContextç®€ä»‹
15-2 å®ç°Contextï¼ŒæŒæ¡Contextçš„åº•å±‚ç»“æ„ä¸æºç å®ç°.mp4_éŸ³é¢‘.mp3
15-3 å®ç°Providerï¼ŒæŒæ¡å…¶åº•å±‚å®ç°.mp4
15-4 å®ç°useContextä¸Contextä¸Valueç®¡ç†ï¼ŒæŒæ¡å…¶æ•°æ®ç»“æ„.mp4_éŸ³é¢‘.mp3
15-5 å®ç°Consumer.mp4
15-6 å®ç°contextTypeï¼ŒæŒæ¡ç±»ç»„ä»¶å¯¹äºContextæ¶ˆè´¹æ–¹å¼çš„åŸç†

ç¬¬16ç«  Reactä¸­çš„æ•°æ®æ¨¡å¼ï¼šContextæºç å‰–æï¼Œæ€ç»´æé«˜
16-1 åˆ†æContextçš„åº•å±‚ç»“æ„ä¸æºç å®ç°
16-2 åˆ†æProviderä¸Context valueæ ˆç®¡ç†ï¼ŒæŒæ¡å…¶åº•å±‚å®ç°
16-3 åˆ†æProviderä¸åä»£ç»„ä»¶æ¶ˆè´¹context value
16-4 åä»£ç»„ä»¶æ¶ˆè´¹çš„ä¸‰ç§æ–¹å¼

ç¬¬17ç«  è·¨æµè§ˆå™¨å…¼å®¹çš„äº‹ä»¶ç³»ç»Ÿï¼šåˆæˆäº‹ä»¶æºç å‰–æ
17-1 Reactä¸­çš„åˆæˆäº‹ä»¶èƒŒæ™¯ä¸å…¶å¿…è¦æ€§
17-2 Reactä¸­çš„äº‹ä»¶æ³¨å†Œ
17-3 Reactä¸­çš„äº‹ä»¶ç»‘å®šä¸äº‹ä»¶å§”æ‰˜
17-4 Reactä¸­çš„äº‹ä»¶æ´¾å‘ï¼ˆä¸Šï¼‰
17-5 Reactä¸­çš„äº‹ä»¶æ´¾å‘ï¼ˆä¸‹ï¼‰
17-6 Reactåˆæˆäº‹ä»¶çš„å®šä¹‰
17-7 ä¸é€‚åˆäº‹ä»¶å§”æ‰˜çš„äº‹ä»¶å¤„ç†

ç¬¬18ç«  è·¨æµè§ˆå™¨å…¼å®¹çš„äº‹ä»¶ç³»ç»Ÿï¼šåˆæˆäº‹ä»¶å®è·µï¼ŒæŒæ¡æ¡†æ¶çº§åˆ«çš„äº‹ä»¶
18-1 å®ç°äº‹ä»¶æ³¨å†Œ
18-2 å®ç°äº‹ä»¶ç»‘å®šä¸äº‹ä»¶å§”æ‰˜
18-3 -1å®ç°äº‹ä»¶æ´¾å‘
18-4 -2å®ç°äº‹ä»¶æ´¾å‘
18-5 å®ç°åˆæˆäº‹ä»¶
18-6 å®ç°å—æ§ç»„ä»¶äº‹ä»¶.mp4

ç¬¬19ç«  æ€§èƒ½æé«˜ï¼šReact Lanesæ¨¡å‹æºç å‰–æ
19-1 React Lanesæ¨¡å‹èƒŒæ™¯
19-2 React Lanesæ¨¡å‹çš„åº”ç”¨
19-3 React Lanes æ¨¡å‹å¸¸ç”¨å·¥å…·å‡½æ•°
19-4 React18æ–°å¢çš„transition
19-5 useDeferredValueåŸç†

ç¬¬20ç«  æ€§èƒ½æé«˜ï¼šReact Lanesæ¨¡å‹æ‰‹åŠ¨å®è·µ
20-1 -1 å®ç°memo
20-2 -2 å®ç°memo
20-3 è¡¥å……å—æ§ç»„ä»¶äº‹ä»¶
20-4 å®ç°lanesæ¨¡å‹

ç¬¬21ç«  è¯¾ç¨‹æ€»ç»“
21-1 è¯¾ç¨‹æ€»ç»“.mp4
21-2 æ‹“å±•ï¼šå“ªäº›Reactæœªæ­£å¼å‘å¸ƒçš„åŠŸèƒ½
```

:::

## æ­å»ºé¡¹ç›®

### monorepo ç¯å¢ƒ

ğŸ‘‡ æ„å»ºç›®å½•

monorepo åŸºäº pnpm

```shell
mkdir an-mini-react && cd an-mini-react && pnpm init

mkdir packages && cd packages

mkdir react && cd react && pnpm init && cd ..
mkdir react-dom && cd react-dom && pnpm init && cd ..
mkdir react-reconciler && cd react-reconciler && pnpm init && cd ..
mkdir scheduler && cd scheduler && pnpm init && cd ..
mkdir shared && cd shared && pnpm init && cd ..
```

æ–°å»º `pnpm-workspace.yaml`

```yaml
packages:
  - 'packages/*'
```

ğŸ‘‡ å®‰è£…å…¬å…±ä¾èµ–

```shell
pnpm add vitest -Dw
```

ğŸ‘‡ å…±äº«é¡¹ç›®å†…repo

å®‰è£… `shared` ç»™ `scheduler` ä½¿ç”¨

```shell
pnpm add shared --filter scheduler
```

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20241204162247834.png?x-oss-process=image/format,webp/resize,w_340)

### demo ç¯å¢ƒ

åŸºäºviteï¼Œ`pnpm create vite ç›®å½•å --template æ¨¡æ¿æšä¸¾`

```shell
pnpm create vite examples --template react-ts
cd examples
pnpm i
pnpm dev
```

## å®ç°ä»»åŠ¡è°ƒåº¦ç®—æ³•

å‰ç½®çŸ¥è¯†ï¼šç®—æ³•

```text
ç»™ä½ ä¸€ä¸ªæ•°å­—æ•°ç»„[1,2,3,4,5,6]ï¼Œæ‰¾å‡ºæœ€å°çš„æ•°å­—ï¼Œæ€ä¹ˆè§£ï¼Ÿ

1. Array.sort
2. éå†æ¯”è¾ƒæ‰¾å‡ºæœ€å°å€¼

å¦‚æœè¿™ä¸ªæ•°ç»„æ˜¯åŠ¨æ€çš„ï¼Œæ‰¾åˆ°ä¹‹åå°±ä»æ•°ç»„é‡Œåˆ é™¤è¿™ä¸ªå…ƒç´ ï¼Œå¹¶ä¸”è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œè¿˜ä¼šä¸æ–­æœ‰æ–°çš„æ•°å­—æ’å…¥æ•°ç»„

Array.sort - æ¯æ¬¡ sortï¼Œåªå–ç¬¬ä¸€ä¸ªï¼Œè€—æ—¶æŠŠç¬¬äºŒå’Œç¬¬ä¸€ä¸‡éƒ½æ’é‚£ä¹ˆå‡†ç¡®ï¼Œæ˜¯æ— ç”¨çš„
```

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæœ€å°å †ï¼ˆMin Heapï¼‰æ¥ä¿æŒæœ€æ–°çš„kä¸ªæœ€å¤§å…ƒç´ ã€‚æœ€å°å †çš„æ ¹èŠ‚ç‚¹å°†å§‹ç»ˆæ˜¯è¿™kä¸ªå…ƒç´ ä¸­æœ€å°çš„é‚£ä¸ªï¼Œä¹Ÿå°±æ˜¯ç¬¬kå¤§çš„å…ƒç´ ã€‚

### æœ€å°å †

å †æ˜¯ä¸€ç§ç‰¹æ®Šçš„äºŒå‰æ ‘ï¼Œæ»¡è¶³ä»¥ä¸‹æ€§è´¨ï¼š

- `å®Œå…¨äºŒå‰æ ‘`ï¼šé™¤äº†æœ€åä¸€å±‚å¤–ï¼Œå…¶ä»–æ¯ä¸€å±‚éƒ½è¢«å®Œå…¨å¡«å……ï¼Œå¹¶ä¸”æ‰€æœ‰èŠ‚ç‚¹éƒ½å°½å¯èƒ½é å·¦æ’åˆ—ã€‚
- `æœ€å°å †`ï¼šæ˜¯ä¸€ç§ç»è¿‡æ’åºçš„ `å®Œå…¨äºŒå‰æ ‘`ï¼Œçˆ¶èŠ‚ç‚¹çš„å€¼æ€»æ˜¯ `å°äºæˆ–ç­‰äº` å…¶å­èŠ‚ç‚¹çš„å€¼
- `æœ€å¤§å †`ï¼šæ˜¯ä¸€ç§ç»è¿‡æ’åºçš„ `å®Œå…¨äºŒå‰æ ‘`ï¼Œçˆ¶èŠ‚ç‚¹çš„å€¼æ€»æ˜¯ `å¤§äºæˆ–ç­‰äº` å…¶å­èŠ‚ç‚¹çš„å€¼

ç”¨æ™®é€š **ä¸€ç»´æ•°ç»„** æ¥è¡¨ç¤ºå †ï¼Œè€Œä¸æ˜¯å®é™…æ„å»ºä¸€æ£µäºŒå‰æ ‘ï¼ˆè¿™æ˜¯å› ä¸ºå®Œå…¨äºŒå‰æ ‘å¯ä»¥ç”¨æ•°ç»„é«˜æ•ˆåœ°è¡¨ç¤ºï¼Œè€Œä¸éœ€è¦é¢å¤–çš„ç©ºé—´æ¥å­˜å‚¨æŒ‡é’ˆï¼‰

#### é€æ­¥æ„é€ æœ€å°å †æ•°æ®ç»“æ„

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ•°ç»„`[4, 5, 8, 2]`ï¼Œæˆ‘ä»¬è¦æŠŠå®ƒæ„å»ºæˆä¸€ä¸ªæœ€å°å †

1. **æ’å…¥å…ƒç´ å¹¶ä¸Šæµ®**
   - æ’å…¥`4`ï¼Œå› ä¸ºæ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç›´æ¥ä½œä¸ºæ ¹èŠ‚ç‚¹ã€‚
   - æ’å…¥`5`ï¼Œä½œä¸º`4`çš„å·¦å­èŠ‚ç‚¹ã€‚
   - æ’å…¥`8`ï¼Œä½œä¸º`4`çš„å³å­èŠ‚ç‚¹ã€‚
   - æ’å…¥`2`ï¼Œéœ€è¦ä¸çˆ¶èŠ‚ç‚¹`5`äº¤æ¢ä½ç½®ä»¥ç»´æŒå †åºå±æ€§ã€‚

```plaintext
Step 1:
       4
      / \
     5   8

Step 2 (Insert 2 and swap):
       4
      / \
     2   8
    /
   5
```

2. **è°ƒæ•´å †**

   - `2`æ¯”å…¶çˆ¶èŠ‚ç‚¹`4`å°ï¼Œæ‰€ä»¥ç»§ç»­ä¸çˆ¶èŠ‚ç‚¹äº¤æ¢ã€‚

```plaintext
Final Min Heap:
       2
      / \
     4   8
    /
   5
```

ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªæœ€å°å †ï¼Œå…¶ä¸­æ ¹èŠ‚ç‚¹`2`æ˜¯æœ€å°çš„å…ƒç´ 

âœ¨ å¯¹åº”çš„æ•°æ®ä¸º `heap = [2, 4, 8, 5]`

#### æ·»åŠ æ–°å…ƒç´ 

å¦‚æœæˆ‘ä»¬è¦æ·»åŠ ä¸€ä¸ªæ–°çš„å…ƒç´ ï¼Œæ¯”å¦‚`3`ï¼Œæˆ‘ä»¬ä¼šå°†å®ƒæ’å…¥åˆ°æ•°ç»„æœ«å°¾ï¼Œç„¶åæ ¹æ®éœ€è¦è¿›è¡Œä¸Šæµ®æ“ä½œï¼š

```plaintext
Before Insert:
       2
      / \
     4   8
    /
   5

After Insert (3):
       2
      / \
     4   8
    / \
   5   3

After Swap (if necessary):
       2
      / \
     3   8
    / \
   5   4
```

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ`3`è¢«æ’å…¥åéœ€è¦ä¸çˆ¶èŠ‚ç‚¹`4`äº¤æ¢ä½ç½®ï¼Œå› ä¸ºå®ƒæ›´å°

âœ¨ å¯¹åº”çš„æ•°æ®ä¸º `heap = [2, 3, 4, 8, 5]`

#### æå–æœ€å°å…ƒç´ 

å½“æˆ‘ä»¬ä»æœ€å°å †ä¸­æå–æœ€å°å…ƒç´ æ—¶ï¼Œæˆ‘ä»¬å°†æ ¹èŠ‚ç‚¹ç§»é™¤ï¼Œå¹¶å°†æœ€åä¸€ä¸ªå…ƒç´ ç§»åˆ°æ ¹çš„ä½ç½®ï¼Œç„¶åé€šè¿‡ä¸‹æ²‰æ“ä½œæ¢å¤å †åºå±æ€§ã€‚

```plaintext
Extract Min:
Remove 2, replace with 4:

       4
      / \
     3   8
    /
   5

Sink Down:
       3
      / \
     4   8
    /
   5
```

âœ¨ å¯¹åº”çš„æ•°æ®ä¸º `heap = [3, 4, 8, 5]`

ğŸ‘‡ æ­£å› ä¸ºä½¿ç”¨äº†ä¸€ç»´æ•°ç»„åšå †çš„æ•°æ®ç»“æ„ï¼Œå› æ­¤å½“éœ€è¦ **æŒ‰å›¾å½¢çš„èŠ‚ç‚¹æ¦‚å¿µ** æ¥æ“ä½œå †æ—¶éœ€è¦çŸ¥é“å¦‚ä½•è®¡ç®—å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„ç´¢å¼•

å¯¹äºä¸€ä¸ªåŸºäº0ç´¢å¼•çš„æ•°ç»„è¡¨ç¤ºçš„æœ€å°å †ï¼š

- çˆ¶èŠ‚ç‚¹ `i` çš„å·¦å­èŠ‚ç‚¹ä½äºç´¢å¼• `2 * i + 1`
- çˆ¶èŠ‚ç‚¹ `i` çš„å³å­èŠ‚ç‚¹ä½äºç´¢å¼• `2 * i + 2`
- å­èŠ‚ç‚¹ `i` çš„çˆ¶èŠ‚ç‚¹ä½äºç´¢å¼• `Math.floor((i - 1) / 2)`

#### leetcode

å›åˆ°é¢˜ç›® [703. æ•°æ®æµä¸­çš„ç¬¬ K å¤§å…ƒç´ - leetcode](https://leetcode.cn/problems/kth-largest-element-in-a-stream/description/)

> æ‰¾åˆ°æ•°æ®æµä¸­ç¬¬ k å¤§å…ƒç´ 

1. åˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰åˆå§‹å…ƒç´ åŠ å…¥åˆ°æœ€å°å †ä¸­ï¼Œä½†åªä¿ç•™æœ€å¤§çš„kä¸ªå…ƒç´ ã€‚
2. æ¯å½“æˆ‘ä»¬è°ƒç”¨`add`æ–¹æ³•æ—¶ï¼Œæˆ‘ä»¬å°†æ–°å€¼æ’å…¥åˆ°æœ€å°å †ä¸­ï¼Œå¹¶ç¡®ä¿å †å¤§å°ä¸è¶…è¿‡kã€‚å¦‚æœè¶…è¿‡ï¼Œåˆ™ç§»é™¤å †é¡¶å…ƒç´ ï¼ˆå³æœ€å°çš„å…ƒç´ ï¼‰ã€‚
3. `add`æ–¹æ³•è¿”å›æœ€å°å †çš„é¡¶éƒ¨å…ƒç´ ï¼Œå®ƒä»£è¡¨å½“å‰æ•°æ®æµä¸­çš„ç¬¬kå¤§å…ƒç´ ã€‚

ä¸ºäº†é«˜æ•ˆåœ°æ‰¾åˆ°ç¬¬kå¤§çš„å…ƒç´ ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§èƒ½å¤Ÿåœ¨æ·»åŠ æ–°å…ƒç´ æ—¶å¿«é€Ÿæ›´æ–°å’ŒæŸ¥è¯¢çš„æ•°æ®ç»“æ„

**å †** æ˜¯ä¸€ç§éå¸¸é€‚åˆè¿™ç§åœºæ™¯çš„æ•°æ®ç»“æ„ï¼Œå› ä¸ºå®ƒå¯ä»¥åœ¨ `O(log n)` çš„æ—¶é—´å¤æ‚åº¦å†…æ’å…¥æˆ–åˆ é™¤å…ƒç´ ï¼Œå¹¶ä¸”å¯ä»¥åœ¨ `O(1)` çš„æ—¶é—´å¤æ‚åº¦å†…è®¿é—®æœ€å°æˆ–æœ€å¤§å…ƒç´ ï¼ˆå–å†³äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯æœ€å°å †è¿˜æ˜¯æœ€å¤§å †ï¼‰

```js
// æ’å…¥å…ƒç´ åˆ°æœ€å°å †å¹¶ç»´æŒå †æ€§è´¨
function insert(heap, value) {
  heap.push(value);
  let i = heap.length - 1;
  while (i > 0) {
    let parentIndex = Math.floor((i - 1) / 2);
    if (heap[parentIndex] <= heap[i]) break;
    [heap[parentIndex], heap[i]] = [heap[i], heap[parentIndex]];
    i = parentIndex;
  }
}

// ç§»é™¤å †é¡¶å…ƒç´ å¹¶ç»´æŒå †æ€§è´¨
function extractMin(heap) {
  if (heap.length === 0) return;
  const min = heap[0];
  const last = heap.pop();
  if (heap.length > 0) {
    heap[0] = last;
    sinkDown(heap, 0);
  }
  return min;
}

// ä¸‹æ²‰å †é¡¶å…ƒç´ ä»¥ç»´æŒå †æ€§è´¨
function sinkDown(heap, index) {
  let length = heap.length;
  let element = heap[index];

  while (true) {
    let leftChildIndex = 2 * index + 1;
    let rightChildIndex = 2 * index + 2;
    let swap = null;

    if (leftChildIndex < length && heap[leftChildIndex] < element) {
      swap = leftChildIndex;
    }

    if (
      rightChildIndex < length &&
      ((swap === null && heap[rightChildIndex] < element) ||
        (swap !== null && heap[rightChildIndex] < heap[swap]))
    ) {
      swap = rightChildIndex;
    }

    if (swap === null) break;
    heap[index] = heap[swap];
    heap[swap] = element;
    index = swap;
  }
}

// åˆ›å»ºKthLargestå¤„ç†å‡½æ•°ï¼Œå¹¶è¿”å›addæ–¹æ³•
function createKthLargest(k, nums) {
  // åˆå§‹åŒ–æœ€å°å †
  const minHeap = [];

  // åˆå§‹åŒ–æœ€å°å †
  nums.forEach((num) => {
    insert(minHeap, num);
    if (minHeap.length > k) extractMin(minHeap);
  });

  // è¿”å›ä¸€ä¸ªåŒ…å« add æ–¹æ³•çš„æ–°å‡½æ•°
  return function add(val) {
    insert(minHeap, val);
    if (minHeap.length > k) extractMin(minHeap);
    return minHeap.length === k ? minHeap[0] : null;
  };
}

// ç¤ºä¾‹æµ‹è¯•
const add = createKthLargest(3, [4, 5, 8, 2]);
console.log(add(3)); // è¿”å› 4
console.log(add(5)); // è¿”å› 5
console.log(add(10)); // è¿”å› 5
console.log(add(9)); // è¿”å› 8
console.log(add(4)); // è¿”å› 8
```

è¿™ä¸ªè§£å†³æ–¹æ¡ˆçš„æ—¶é—´å¤æ‚åº¦ä¸»è¦ç”±æ’å…¥å’Œåˆ é™¤æ“ä½œå†³å®šï¼Œå¯¹äºæ¯ä¸ªæ“ä½œéƒ½æ˜¯O(log k)ï¼Œå…¶ä¸­kæ˜¯æˆ‘ä»¬éœ€è¦ç»´æŠ¤çš„æœ€å°å †çš„å¤§å°ã€‚åˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¯¹nä¸ªå…ƒç´ è¿›è¡Œè¿™æ ·çš„æ“ä½œï¼Œå› æ­¤åˆå§‹åŒ–çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n log k)ã€‚ç©ºé—´å¤æ‚åº¦ä¸ºO(k)ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦å­˜å‚¨kä¸ªå…ƒç´ åœ¨æœ€å°å †ä¸­ã€‚

### React ä»»åŠ¡è°ƒåº¦

åœ¨ `React 16` å¼•å…¥çš„Fiberæ¶æ„ä¹‹åã€‚Fiberä½¿å¾—Reactèƒ½å¤Ÿä¸­æ–­æ¸²æŸ“è¿‡ç¨‹å¹¶åœ¨å¿…è¦æ—¶æ¢å¤ï¼Œä»è€Œæé«˜äº†äº¤äº’æ€§èƒ½

ä¸ºäº†æ”¯æŒè¿™ç§èƒ½åŠ›ï¼ŒReactéœ€è¦ä¸€ç§æœºåˆ¶æ¥ç¡®å®šå“ªäº›æ›´æ–°æœ€é‡è¦ï¼Œåº”è¯¥ä¼˜å…ˆå¤„ç†

> ä»»åŠ¡è°ƒåº¦: æ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§æˆ–å…¶ä»–æ¡ä»¶æ¥å†³å®šå“ªä¸ªä»»åŠ¡åº”è¯¥æœ€å…ˆè¢«æ‰§è¡Œ

âœ¨ ä½¿ç”¨æœ€å°å †æ¥å®ç°ä»»åŠ¡è°ƒåº¦

ğŸ‘‡ `ä»»åŠ¡è°ƒåº¦` å’Œ `leetcode` ç®—æ³•é¢˜ä¸ä¸€æ ·çš„æ˜¯:

1. åªå…³æ³¨é¡¶å±‚èŠ‚ç‚¹ï¼Œä¸å…³æ³¨k(æŒ‡å®šå‚æ•°)
2. æ¯æ¬¡å¤„ç†åéƒ½ä¼šç§»é™¤é¡¶èŠ‚ç‚¹ï¼Œå³: è§¦å‘æœ€å°å †çš„ `extractMin()`
