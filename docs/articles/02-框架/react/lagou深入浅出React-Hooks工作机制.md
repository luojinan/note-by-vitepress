# Hooks å·¥ä½œæœºåˆ¶

[æ·±å…¥ React-Hooks å·¥ä½œæœºåˆ¶ï¼šâ€œåŸåˆ™â€çš„èƒŒåï¼Œæ˜¯â€œåŸç†â€](https://github.com/luojinan/lagou-crawler/blob/b23f776d6d428f99073e8e4ec621453b5642f7fb/download/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BA%E6%90%9E%E5%AE%9A%20React/%E6%A8%A1%E5%9D%97%E4%BA%8C%EF%BC%9A%E5%88%A8%E6%A0%B9%E9%97%AE%E5%BA%95%E5%90%83%E9%80%8F%E2%80%9C%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E2%80%9D/08%20-%20%E6%B7%B1%E5%85%A5%20React-Hooks%20%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6%EF%BC%9A%E2%80%9C%E5%8E%9F%E5%88%99%E2%80%9D%E7%9A%84%E8%83%8C%E5%90%8E%EF%BC%8C%E6%98%AF%E2%80%9C%E5%8E%9F%E7%90%86%E2%80%9D.md)

å¾ˆå¤šæ•™ç¨‹è®²è§£ `Hooks` åŸç†æ—¶éƒ½æ‹¿ `useState` ä¸¾ä¾‹æˆ–è‡ªå·±å®ç°ä¸€ä¸ª `useState`ï¼Œä½†æ˜¯ç»å¸¸å‘ç°ç†è§£äº† `useState` åŸç†å¹¶ä¸èƒ½è§£é‡Šå…¶ä»–çš„ `Hooks` åŸç†

æ­¤å¤„ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£ `Hooks` å·¥ä½œæœºåˆ¶ï¼Œå¹¶ä¸ç­‰äºå…·ä½“çš„ `Hooks` åŸç†ï¼Œæˆ‘ä»¬éœ€è¦ç†è§£åœ¨ React å‡½æ•°ç»„ä»¶ä¸­ `Hooks` åˆ°åº•æ˜¯æ€ä¹ˆç”Ÿæ•ˆçš„

ä¸å»ºè®®å¯¹ `Fiber` åº•å±‚å®ç°æ²¡æœ‰è®¤çŸ¥çš„å‰æä¸‹å»å’Œ `Hooks` æºç æ­»ç£•ã€‚

âœ¨ é‡ç‚¹ç†è§£ï¼š`Hooks` è§¦å‘å‡½æ•°ç»„ä»¶é‡æ–°æ¸²æŸ“ çš„ä¸€äº›ç°è±¡

> ä¸ºä»€ä¹ˆä¸èƒ½åœ¨å¾ªç¯ã€æ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ `Hook` ?

## useState è¿™ä¸ª Hooks çš„æœ¬è´¨

å› æ­¤ï¼Œæˆ‘ä»¬ä¾ç„¶æ‹¿ `useState` æ¥ä»‹ç» `Hooks` åœ¨å‡½æ•°ç»„ä»¶ä¸­çš„å·¥ä½œæœºåˆ¶ã€‚

é¦–å…ˆæˆ‘ä»¬çš„å‰ç½®çŸ¥è¯†æ˜¯ `useState` çš„ç°è±¡å’ŒåŸç†ï¼Œä»¥æ­¤æ¥çœ‹ `Hooks` åšäº†ä»€ä¹ˆï¼Œæ³¨æ„ï¼Œä¸æ˜¯ç†è§£äº† `useState` å°±ç†è§£äº† `Hooks` çš„å·¥ä½œæœºåˆ¶ï¼

### useState æ¦‚å¿µ

```jsx
import { useState } from "react";

export default const MyComp = () => {
  const [name] = useState("æˆ‘");
  const [age, setAge] = useState(1);

  console.log(`name: ${name}, age: ${age}`)

  // ç¼–å†™ UI é€»è¾‘
  return <div onClick={()=>setAge(2)}>ä¸å…³å¿ƒUI</div>
}
```

ğŸ‘† é€šè¿‡æŸ¥çœ‹æ§åˆ¶å°æ‰“å°æ¥æŸ¥çœ‹ å‡½æ•°ç»„ä»¶çŠ¶æ€

- ç»„ä»¶åˆå§‹åŒ–æ—¶æ‰“å° `name: æˆ‘, age: 1 `
- ç‚¹å‡»è§¦å‘æ›´æ–°çŠ¶æ€æ—¶æ‰“å° `name: æˆ‘, age: 2 `

æˆ‘ä»¬éƒ½çŸ¥é“ `å‡½æ•°ç»„ä»¶` é€šè¿‡ **æ•´ä¸ªå‡½æ•°é‡æ–°æ‰§è¡Œ** æ¥è¾¾åˆ°æ›´æ–° UI çš„æ•ˆæœ

è€Œ `useState` æ‰€åšçš„äº‹æƒ…æœ¬è´¨å°±æ˜¯

1. æ›´æ–°å˜é‡çŠ¶æ€
2. è§¦å‘å‡½æ•°ç»„ä»¶é‡æ–°æ¸²æŸ“

### æ‰‹å†™ useState

ğŸ‘‡ ä¸€äº›æ•™ç¨‹ä¸­è‡ªå·±å®ç°çš„ `useState` å°±æ˜¯è¿™æ ·ï¼š

```js
// âœ¨ ç¤ºä¾‹ç®€æ˜“çš„ å‡½æ•°ç»„ä»¶ é‡æ–°æ¸²æŸ“
function render() {
  ReactDOM.render(<App />, document.getElementById("root"));
}

// âœ¨ useState å‡½æ•°å¤–ç»´æŠ¤å˜é‡çŠ¶æ€å€¼
let state: any;

function useState<T>(initialState: T): [T, (newState: T) => void] {
  state = state || initialState;

  function setState(newState: T) {
    state = newState; // âœ¨ 1. æ›´æ–°å˜é‡çŠ¶æ€
    render(); // âœ¨ 2. è§¦å‘å‡½æ•°ç»„ä»¶é‡æ–°æ¸²æŸ“
  }

  return [state, setState];
}

render(); // é¦–æ¬¡æ¸²æŸ“(ä¸æ˜¯useStateçš„äº‹)
```

## æ¡ä»¶è¯­å¥ä¸­ä½¿ç”¨ Hooks

### ç°è±¡

å‡å¦‚å¸Œæœ›é¦–æ¬¡æ¸²æŸ“åˆå§‹åŒ–å‡º name çš„æ•°æ®åï¼Œæ›´æ–°ç»„ä»¶ä¸èµ° `useState` è°ƒç”¨

```jsx
let isMounted = false;
const MyComp = () => {
  console.log("isMounted is", isMounted);

  let name, setName;

  // åœ¨é¦–æ¬¡æ¸²æŸ“ï¼ˆç»„ä»¶è¿˜æœªæŒ‚è½½ï¼‰æ—¶ï¼Œæ‰è·å– nameã€age ä¸¤ä¸ªçŠ¶æ€
  if (!isMounted) {
    // eslint-disable-next-line
    [name, setName] = useState("æˆ‘");
    // if å†…éƒ¨çš„é€»è¾‘æ‰§è¡Œä¸€æ¬¡åï¼Œå°±å°† isMounted ç½®ä¸º trueï¼ˆè¯´æ˜å·²æŒ‚è½½ï¼Œåç»­éƒ½ä¸å†æ˜¯é¦–æ¬¡æ¸²æŸ“äº†ï¼‰
    isMounted = true;
  }

  const [age] = useState(1);

  console.log(`name: ${name}, age: ${age}`);

  // ç¼–å†™ UI é€»è¾‘
  return <div onClick={() => setName("ä½ ")}>ä¸å…³å¿ƒUI</div>;
};
```

`// eslint-disable-next-line` è¿™ä¸ªæ³¨é‡Š

ç›®å‰å¤§éƒ¨åˆ†çš„ React é¡¹ç›®éƒ½åœ¨å†…éƒ¨é¢„ç½®äº†å¯¹ `React-Hooks-Ruleï¼ˆReact-Hooks ä½¿ç”¨è§„åˆ™ï¼‰` çš„å¼ºæ ¡éªŒï¼Œè€Œç¤ºä¾‹ä»£ç ä¸­æŠŠ `Hooks` æ”¾è¿› `if` è¯­å¥çš„æ“ä½œä½œä¸ºä¸€ç§ä¸åˆè§„æ“ä½œï¼Œä¼šè¢«ç›´æ¥è¯†åˆ«ä¸º `Error` çº§åˆ«çš„é”™è¯¯ï¼Œè¿›è€Œå¯¼è‡´ç¨‹åºæŠ¥é”™

è¿™é‡Œæˆ‘ä»¬åªæœ‰å°†ç›¸å…³ä»£ç çš„ `eslint` æ ¡éªŒç»™ç¦ç”¨æ‰ï¼Œæ‰èƒ½å¤Ÿé¿å…æ ¡éªŒæ€§è´¨çš„æŠ¥é”™ï¼Œä»è€Œæ›´ç›´è§‚åœ°çœ‹åˆ°é”™è¯¯çš„æ•ˆæœåˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„ï¼Œè¿›è€Œç†è§£é”™è¯¯çš„åŸå› ã€‚

ğŸ‘‡ react æŠ¥é”™ï¼š `æœ¬æ¬¡æ¸²æŸ“ hooks å°‘äºé¢„æœŸ`
![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/202308151151109.png)

ğŸ‘‡ æ§åˆ¶å°è¾“å‡ºï¼š

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/202308151151869.png)

ä»æ§åˆ¶å°çœ‹å‡ºæƒ³è¦è®¾ç½®çš„ `name` å˜ä¸º `undefined` ï¼Œè€Œä¸è®¾ç½®çš„ `age` å˜ä¸º `ä½ `

ä¹Ÿå°±æ˜¯ `setName` è¿™ä¸ª `useState` æˆåŠŸè§¦å‘äº†é‡æ–°æ¸²æŸ“ï¼Œä¹ŸæˆåŠŸè§¦å‘äº†çŠ¶æ€æ›´æ–°ï¼Œä½†æ˜¯æ›´æ–°çš„å˜é‡å‡ºé”™äº†

æˆ‘ä»¬é€šè¿‡æ–‡æ¡£å’ŒæŠ¥é”™æ¶ˆæ¯å¯ä»¥çŸ¥é“è¿™æ˜¯å› ä¸ºåˆå§‹åŒ–å‡½æ•°ç»„ä»¶å’Œé‡æ–°æ¸²æŸ“å‡½æ•°ç»„ä»¶çš„ `Hooks` æ•°é‡ or é¡ºåºä¸ä¸€è‡´å¼•èµ·çš„

ä¹Ÿå°±æ˜¯ `Hooks` çš„å·¥ä½œæœºåˆ¶ä¸ `Hooks` å®šä¹‰çš„é¡ºåºå¼ºç›¸å…³

ä»ç¤ºä¾‹ä¹Ÿèƒ½çœ‹å‡ºåœ¨æ¡ä»¶è¯­å¥ä¸‹çš„ç¬¬ä¸€ä¸ª `useState` æ˜¯ `age` å› æ­¤åˆå§‹åŒ–æ—¶ç¬¬ä¸€ä¸ªçš„ `setName` æ›´æ–°äº† `age` çš„å€¼

### åŸç†åˆ†æ

- `React-Hooks` åœ¨æºç å±‚é¢å’Œ `Fiber` å…³è”ååˆ†å¯†åˆ‡ï¼Œæˆ‘ä»¬ç›®å‰ä»ç„¶å¤„äºåŸºç¡€å¤¯å®é˜¶æ®µï¼Œå¯¹ `Fiber` æœºåˆ¶ç›¸å…³çš„åº•å±‚å®ç°æš‚æ—¶æ²¡æœ‰è®¨è®ºï¼Œç›²ç›®å•ƒæºç åœ¨è¿™ä¸ªé˜¶æ®µæ¥è¯´æ²¡æœ‰æ„ä¹‰ï¼›

- `React-Hooks` çš„æºç é“¾è·¯ç›¸å¯¹æ¥è¯´æ¯”è¾ƒé•¿ï¼Œæ¶‰åŠçš„å…³é”®å‡½æ•° `renderWithHooks` ä¸­â€œè„é€»è¾‘â€ä¹Ÿæ¯”è¾ƒå¤šï¼Œæ•´ä½“æ¥è¯´ï¼Œå­¦ä¹ æˆæœ¬æ¯”è¾ƒé«˜ï¼Œå­¦ä¹ æ•ˆæœä¹Ÿéš¾ä»¥ä¿è¯ã€‚

ğŸ‘‡ `useState` åœ¨ `å‡½æ•°ç»„ä»¶` æ‰§è¡Œæ—¶çš„æ­¥éª¤

![å›¾ç‰‡12.png](https://s0.lgstatic.com/i/image/M00/67/59/Ciqc1F-hJYCAWVjCAAEtNT9pGHA170.png)
![å›¾ç‰‡13.png](https://s0.lgstatic.com/i/image/M00/67/59/Ciqc1F-hJTGANs5yAAD4e6ACv8Q643.png)

- mountStateï¼ˆåˆå§‹åŒ–ï¼‰æ„å»ºé“¾è¡¨å¹¶æ¸²æŸ“
- updateState ä¾æ¬¡éå†é“¾è¡¨å¹¶æ¸²æŸ“ - **æŒ‰é¡ºåºå»éå†ä¹‹å‰æ„å»ºå¥½çš„é“¾è¡¨ï¼Œå–å‡ºå¯¹åº”çš„æ•°æ®ä¿¡æ¯è¿›è¡Œæ¸²æŸ“**ã€‚

è¿™ä¸ªç°è±¡æœ‰ç‚¹åƒæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªé•¿åº¦ç¡®å®šçš„æ•°ç»„ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªå‘ä½éƒ½å¯¹åº”ç€ä¸€å—ç¡®åˆ‡çš„ä¿¡æ¯ï¼Œåç»­æ¯æ¬¡ä»æ•°ç»„é‡Œå–å€¼çš„æ—¶å€™ï¼Œåªèƒ½å¤Ÿé€šè¿‡ç´¢å¼•ï¼ˆä¹Ÿå°±æ˜¯ä½ç½®ï¼‰æ¥å®šä½æ•°æ®

ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œåœ¨è®¸å¤šæ–‡ç« é‡Œï¼Œéƒ½ä¼šç›´æˆªäº†å½“åœ°ä¸‹è¿™æ ·çš„å®šä¹‰ï¼š`Hooks` çš„æœ¬è´¨å°±æ˜¯æ•°ç»„

ä½†è¯»å®Œè¿™ä¸€è¯¾æ—¶çš„å†…å®¹ä½ å°±ä¼šçŸ¥é“ï¼Œ**Hooks çš„æœ¬è´¨å…¶å®æ˜¯é“¾è¡¨**ã€‚

[é“¾è¡¨ linkedlist](../../04-é¢è¯•/é¢˜åº“/é¢è¯•-æ•°æ®ç»“æ„.md#é“¾è¡¨linkedlist)

`useState` æºç ç¤ºä¾‹

```jsx
function mountState(initialState) {
  // initialState å¯ä»¥æ˜¯å¾…æ‰§è¡Œçš„å‡½æ•°
  if (typeof initialState === "function") initialState = initialState();

  // åˆ›å»ºå½“å‰ hook å¯¹è±¡çš„æ›´æ–°é˜Ÿåˆ—ï¼Œè¿™ä¸€æ­¥ä¸»è¦æ˜¯ä¸ºäº†èƒ½å¤Ÿä¾åºä¿ç•™ dispatch
  // å°†æ–°çš„ hook å¯¹è±¡è¿½åŠ è¿›é“¾è¡¨å°¾éƒ¨
  var hook = mountWorkInProgressHook();
  const queue = (hook.queue = {
    last: null,
    dispatch: null,
    lastRenderedReducer: basicStateReducer,
    lastRenderedState: (initialState: any),
  });

  // å°† initialState ä½œä¸ºä¸€ä¸ªâ€œè®°å¿†å€¼â€å­˜ä¸‹æ¥
  hook.memoizedState = hook.baseState = initialState;

  // dispatch æ˜¯ç”±ä¸Šä¸‹æ–‡ä¸­ä¸€ä¸ªå« dispatchAction çš„æ–¹æ³•åˆ›å»ºçš„ï¼Œè¿™é‡Œä¸å¿…çº ç»“è¿™ä¸ªæ–¹æ³•å…·ä½“åšäº†ä»€ä¹ˆ
  const dispatch = (queue.dispatch = dispatchAction.bind(
    null,
    currentlyRenderingFiber$1,
    queue
  ));
  // âœ¨ setXXX å°±æ˜¯ dispatch æ‰§è¡Œé“¾è¡¨çš„è°ƒåº¦æ–¹æ³•
  return [hook.memoizedState, dispatch];
}
```

ğŸ‘† `useState` æŠŠçŠ¶æ€æ„å»ºåˆ°ä¸€ä¸ª `hook` å¯¹è±¡é‡Œï¼Œè€Œ `hook` å¯¹è±¡ä¹‹é—´ä»¥å•å‘é“¾è¡¨çš„å½¢å¼ç›¸äº’ä¸²è”

![å›¾ç‰‡16.png](https://s0.lgstatic.com/i/image/M00/67/65/CgqCHl-hJe2ATIhGAAHpze3gFHg893.png)
ğŸ‘† `useState` å¹¶ä¸å…³å¿ƒå˜é‡åï¼Œè€Œæ˜¯æŒ‰é¡ºåºå®šä½åˆ°å¯¹åº”çš„ `hook` å¯¹è±¡, è¿›è¡Œæ“ä½œ

å› æ­¤ï¼Œæˆ‘ä»¬ç†è§£äº† `ä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hook` è¿™å¥è­¦å‘Šçš„åŸå› 

**å¾ªç¯ã€æ¡ä»¶è¯­å¥ã€åµŒå¥—å‡½æ•°** ä¸­ä¸èƒ½ä¿è¯å‡½æ•°ç»„ä»¶å‰åçš„ `Hook` é¡ºåºæ˜¯å¦å§‹ç»ˆä¸€è‡´

### å…¶ä»–å…³äºé“¾è¡¨çš„ç¤ºä¾‹

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/202308151617262.png)

`cursor` - å…‰æ ‡

[ä¸€æ–‡å½»åº•ææ‡‚ react hooks çš„åŸç†å’Œå®ç°](https://juejin.cn/post/6844903975838285838)

[React hooks: not magic, just arrays](https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e)
