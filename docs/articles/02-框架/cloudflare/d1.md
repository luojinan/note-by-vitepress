## Prisma - ORM

* model your database with the Prisma Schema Language
  ä½¿ç”¨ Prisma æ¶æ„è¯­è¨€å¯¹æ•°æ®åº“è¿›è¡Œå»ºæ¨¡
* use Prisma ORM's existing sqlite database connector in your schema
  åœ¨æ‚¨çš„æ¶æ„ä¸­ä½¿ç”¨ Prisma ORM çš„ç°æœ‰ sqlite æ•°æ®åº“è¿æ¥å™¨
* use Prisma Client in your application to talk to the database server at D1
  åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨ Prisma Client ä¸ D1 çš„æ•°æ®åº“æœåŠ¡å™¨é€šä¿¡

@prisma/adapter-d1 driver adapter. ç”¨äºç»™ server ä¾§åˆ›å»ºå®ä¾‹

![](https://kingan-md-img.oss-cn-guangzhou.aliyuncs.com/blog/20250412115156233.png?x-oss-process=image/format,webp/resize,w_640)

### v6.6

`prisma@6.6` ä¹‹åæ ¹ç›®å½•éœ€è¦æ–°å¢ä¸€ä¸ª `prisma.config.ts` æ–‡ä»¶ç”¨äºè¿è¡Œ prisma åŒæ­¥ d1 æ•°æ®åº“çš„ nodejs è„šæœ¬

```ts
import path from 'node:path'
import type { PrismaConfig } from 'prisma'
import { PrismaD1HTTP } from '@prisma/adapter-d1'

// import your .env file
import 'dotenv/config' // âœ¨ éœ€è¦é¢å¤–å®‰è£…ä¸€ä¸ªä¾èµ–dotenv

type Env = {
  CLOUDFLARE_D1_TOKEN: string
  CLOUDFLARE_ACCOUNT_ID: string
  CLOUDFLARE_DATABASE_ID: string
}

export default {
  earlyAccess: true,
  schema: path.join('prisma', 'schema.prisma'),

  migrate: {
    async adapter(env) {
      return new PrismaD1HTTP({
        CLOUDFLARE_D1_TOKEN: env.CLOUDFLARE_D1_TOKEN,
        CLOUDFLARE_ACCOUNT_ID: env.CLOUDFLARE_ACCOUNT_ID,
        CLOUDFLARE_DATABASE_ID: env.CLOUDFLARE_DATABASE_ID,
      })
    },
  },
} satisfies PrismaConfig<Env>
```

ğŸ‘† éœ€è¦é¢å¤–å®‰è£…ä¸€ä¸ªä¾èµ– `pnpm add dotenv -D`

[ç¯å¢ƒå˜é‡](https://www.prisma.io/docs/guides/cloudflare-d1#41-add-needed-environment-variables) é‡Œçš„`.env` æ–‡ä»¶

```text
DATABASE_URL="file:./prisma/db.sqlite"

CLOUDFLARE_ACCOUNT_ID="0773..."
CLOUDFLARE_DATABASE_ID="01f30366-..."
CLOUDFLARE_D1_TOKEN="F8Cg..."
```

`DATABASE_URL` éœ€è¦è®¾ç½®ä¸º `file:./prisma/db.sqlite`ï¼Œå³ä½¿æœ¬åœ°æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ï¼Ÿ

`npx prisma db push`

## sqlite

å¯¼å…¥ json æ•°æ®

```bash
npx wrangler d1 execute an-monkey-db \
  --command="INSERT INTO Income (id, owner, time, baseSalary, overtimeMeal, housingFund, leaveDeduction, housingFundDeduction, medicalInsurance, pensionInsurance, unemploymentInsurance, tax, rent, createdAt, updatedAt) 
  SELECT 
    json_extract(value, '$.id'),
    json_extract(value, '$.owner'),
    json_extract(value, '$.time'),
    json_extract(value, '$.baseSalary'),
    json_extract(value, '$.overtimeMeal'),
    json_extract(value, '$.housingFund'),
    json_extract(value, '$.leaveDeduction'),
    json_extract(value, '$.housingFundDeduction'),
    json_extract(value, '$.medicalInsurance'),
    json_extract(value, '$.pensionInsurance'),
    json_extract(value, '$.unemploymentInsurance'),
    json_extract(value, '$.tax'),
    json_extract(value, '$.rent'),
    json_extract(value, '$.createdAt'),
    json_extract(value, '$.updatedAt')
  FROM json_each('$(cat processed-income-data.json)')" --remote
```
